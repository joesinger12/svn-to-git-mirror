; -------------------------------------------------------------------------
; Rules pertaining to:   Prep For and Clean-up After each CSE Energy Simulation
; CEC Title-24 Nonresidential Energy Code 
; -------------------------------------------------------------------------
; Copyright (c) 2012-2022, California Energy Commission
; Copyright (c) 2012-2016, Wrightsoft Corporation
; All rights reserved.
; Redistribution and use in source and binary forms, with or without modification,
; are permitted provided that the following conditions are met:
; - Redistributions of source code must retain the above copyright notice, this
;   list of conditions and the following disclaimer.
; - Redistributions in binary form must reproduce the above copyright notice, this
;   list of conditions, the following disclaimer in the documentation and/or other
;   materials provided with the distribution.
; - Neither the name of the California Energy Commission nor the names of its
;   contributors may be used to endorse or promote products derived from this
;   software without specific prior written permission.
; DISCLAIMER: THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
; "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
; THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
; NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION,
; WRIGHTSOFT CORPORATION, ITRON, INC. OR ANY OTHER AUTHOR OR COPYRIGHT HOLDER OF
; THIS SOFTWARE (COLLECTIVELY, THE "AUTHORS") BE LIABLE FOR ANY DIRECT, INDIRECT,
; INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
; LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
; OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
; LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
; OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
; ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  EACH LICENSEE AND SUBLICENSEE OF THE
; SOFTWARE AGREES NOT TO ASSERT ANY CLAIM AGAINST ANY OF THE AUTHORS RELATING TO
; THIS SOFTWARE, WHETHER DUE TO PERFORMANCE ISSUES, TITLE OR INFRINGEMENT ISSUES,
; STRICT LIABILITY OR OTHERWISE.
; -------------------------------------------------------------------------


;*************************************************************************
RULELIST "CSE_SimulationPrep_Mat" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering NON-Composite Mat objects only
;*************************************************************************
;"dbg - store BEMProc details" Proj:Action = {  StoreBEMProc( Format( "Before run %s CSE Mat SimPrep", RunAbbrev ), 0 )  }
;"dbg" Mat:Action = { MessageBox( "got here for Mat '%s'", Name )  }

   "Assign/create cseMATERIAL to simulate this Mat in CSE - 1"    Mat:cseMATERIALRef[1] =
      {  if (IfValidAnd( ResThrmlCndctCT >= 0 ))
         then  AssignOrCreateComp( cseMATERIAL, Format( "%s-mat", Name ),
											"matDens", ResDens, "matSpHt", ResSpecHt, "matCond", ResThrmlCndct, "matCondCT", ResThrmlCndctCT )
         else  AssignOrCreateComp( cseMATERIAL, Format( "%s-mat", Name ),
											"matDens", ResDens, "matSpHt", ResSpecHt, "matCond", ResThrmlCndct )
         endif  }

; simple Mat
;  
;   Mat   User: "Gypsum Board - 1/2 in."  
;      CodeCat = UVal: "Bldg Board and Siding"  (20)
;      CodeItem = UVal: "Gypsum Board - 1/2 in."  (2005)
;      RVal = RVal: 0.45
;      ThrmlCndct = RVal: 0.09167
;      SpecHt = RVal: 0.27
;      Dens = RVal: 40
;      Thkns = RVal: 0.5
;      HeatCap = RVal: 0.45
;      AreaResZnSurf = RVal: 0
;   
;   MATERIAL   "m-Gypsum Board"  
;      matDens = 40                         // Density, lb/ft3
;      matSpHt = 0.27                       // Specific heat of material, Btu/lb-°F
;      matCond = 0.09167                    // Conductivity (always per foot of thickness), Btuh-ft/ft2-°F
;      matCondCT = 0.000122                 // Coefficient for temperature adjustment of matCond in the forward difference surface conduction model, F(-1)


; More complex, Composite mat layer -
;
;   MATERIAL   "m-SoftWood"  
;      matDens = 35                         // Density, lb/ft3
;      matSpHt = 0.39                       // Specific heat of material, Btu/lb-°F
;      matCond = 0.08167                    // Conductivity (always per foot of thickness), Btuh-ft/ft2-°F
;      matCondCT = 0.0012                   // Coefficient for temperature adjustment of matCond in the forward difference surface conduction model, F(-1)


END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SimulationPrep_Mat_Composite" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering Composite Mat objects only
;*************************************************************************
;"dbg - store BEMProc details" Proj:Action = {  StoreBEMProc( Format( "Before run %s CSE Mat SimPrep", RunAbbrev ), 0 )  }

;for Composite Mats
;    1=Frm, 2=CavOther, 3=CavCeiling, 4=QIIdegradedCavOther, 5=QIIdegradedCavCeiling
; RJH 3/4/22 - Always create 2-5. Note that if there are no diffs between parameter values for 2&3 or 4&5 then they will reference same "*-cavoth*" name/instance

;Mat:cseMATERIALRef[1] = "%s-frm"

   "Assign/create cseMATERIAL to simulate this Mat in CSE - 1"    Mat:cseMATERIALRef[1] =
      {  if (CodeCat = "Composite" .AND. FrmMat = "Metal")
         then  UNDEFINED   ; no 'frm' material for Metal framed cons (for now)
         else if (IfValidAnd( ResThrmlCndctCT >= 0 ))
         then  AssignOrCreateComp( cseMATERIAL, Format( "%s-frm", Name ),
											"matDens", ResDens, "matSpHt", ResSpecHt, "matCond", ResThrmlCndct, "matCondCT", ResThrmlCndctCT )
         else  AssignOrCreateComp( cseMATERIAL, Format( "%s-frm", Name ),
											"matDens", ResDens, "matSpHt", ResSpecHt, "matCond", ResThrmlCndct )
         endif endif  }


;Mat:cseMATERIALRef[2] = "%s-cav"

   "Assign/create cseMATERIAL to simulate this Mat in CSE - 2"    Mat:cseMATERIALRef[2] =
      {  AssignOrCreateComp( cseMATERIAL, Format( "%s-cavoth", Name ),
										  "matDens", ResCavDens, 
                                          "matSpHt", ResCavSpecHt, 
                                          "matCond", ResCavThrmlCndct, 
                                          "matCondCT", ResCavOtherThrmlCndctCT )
      }

   "Assign/create cseMATERIAL to simulate this Mat in CSE - 3"    Mat:cseMATERIALRef[3] =
      {  AssignOrCreateComp( cseMATERIAL, Format( "%s-cavclg", Name ),
										  "matDens", ResCavDens, 
                                          "matSpHt", ResCavSpecHt, 
                                          "matCond", ResCavThrmlCndct, 
                                          "matCondCT", ResCavCeilingThrmlCndctCT )
      }

   "Assign/create cseMATERIAL to simulate this Mat in CSE - 4"    Mat:cseMATERIALRef[4] =
      {  AssignOrCreateComp( cseMATERIAL, Format( "%s-cavothqiidgrd", Name ),
										  "matDens", ResCavDens, 
                                          "matSpHt", ResCavSpecHt, 
                                          "matCond", ResCavThrmlCndct / ResProj:ICQEnclCavInsMult, 
                                          "matCondCT", ResCavOtherThrmlCndctCT )
      }

   "Assign/create cseMATERIAL to simulate this Mat in CSE - 5"    Mat:cseMATERIALRef[5] =
      {  AssignOrCreateComp( cseMATERIAL, Format( "%s-cavclgqiidgrd", Name ),
										  "matDens", ResCavDens, 
                                          "matSpHt", ResCavSpecHt, 
                                          "matCond", ResCavThrmlCndct / ResProj:ICQEnclCavInsMult, 
                                          "matCondCT", ResCavCeilingThrmlCndctCT )
      }
END

;*************************************************************************
RULELIST "CSE_SimulationPrep_ConsAssm"  1 0 0 1
;*************************************************************************

   "call subordinate ruleset to assign/create cseMATERIAL for those Mat objects needing them"
      Mat:Action = {    if (IfValidAnd( AreaResZnSurf > 0 )==0 .OR.
                            LocalCompAssigned( cseMATERIALRef ) > 0) then  UNCHANGED
                        else if (CodeCat = "Composite")
                        then  EvalRulelist( "CSE_SimulationPrep_Mat_Composite", 1 ) 
                        else  EvalRulelist( "CSE_SimulationPrep_Mat", 1 )  endif endif  }

   "call subordinate ruleset to assign/create Cavity cseCONSTRUCTION and cseLAYER for those ConsAssm objects needing them"
      ConsAssm:Action = {   if (IfValidAnd( AreaResZnSurf > 0 )==0 .OR.
                                LocalCompAssigned( cseCavCONS ) > 0) 
                            then  UNCHANGED
                            else  if (IfValidAnd(ResSurfacesQIINotDegraded > 0) .OR. IfValidAnd(ResSurfacesOfNewZone > 0) .OR. IfValidAnd(ResProj:InsulConsQuality == "Yes")) 
                                  then EvalRulelist( "CSE_SimulationPrep_ConsAssm_Cav", 1 )
                                  else UNCHANGED
                                  endif
                            endif  }
   "call subordinate ruleset to assign/create QIIDegraded Cavity cseCONSTRUCTION and cseLAYER for those ConsAssm objects needing them"  ; separate non-QII degraded from degraded to allow for BOTH to be created - SAC 02/23/22
      ConsAssm:Action = {   if (IfValidAnd( AreaResZnSurf > 0 )==0 .OR.
                                LocalCompAssigned( cseQIIDegradedCavCONS ) > 0) 
                            then  UNCHANGED
                            else  if (IfValidAnd(ResSurfacesQIIDegraded > 0) .OR. IfValidAnd(ResSurfacesOfNotNewZone > 0) .OR. IfValidAnd(ResProj:InsulConsQuality == "No")) 
                                  then EvalRulelist( "CSE_SimulationPrep_ConsAssm_Cav_QIIDegraded", 1 )
                                  else UNCHANGED
                                  endif
                            endif  }

   "call subordinate ruleset to assign/create Frame cseCONSTRUCTION and cseLAYER for those ConsAssm objects needing them"
      ConsAssm:Action = {   if (IfValidAnd( AreaResZnSurf > 0 )==0 .OR.
                                LocalCompAssigned( cseFrmCONS ) > 0) 
                            then  UNCHANGED
                            else if (FrmMat == "Wood")
                            then  EvalRulelist( "CSE_SimulationPrep_ConsAssm_Frm", 1 ) 
                            else  UNCHANGED  endif endif  }

END
;*************************************************************************

;*************************************************************************
RULELIST "CSE_SimulationPrep_ConsAssm_Frm"  1 0 0 1
;*************************************************************************

   "Create cseCONSTRUCTION object for this ConsAssm"     ConsAssm:cseFrmCONS =
      {  CreateComp( cseCONSTRUCTION, Format( "fc-%s", Name ) )  }
   "Set ConsAssm:cseFrmCONS:SourceCons"   ConsAssm:cseFrmCONS:SourceCons = {  Name  }

   "Create cseLAYER objects for this ConsAssm"  for:#Layer=(1to10)   ConsAssm:cseFrmLAYERs[#Layer] =
      {  if (NumMats >= #Layer .AND. LocalCompAssigned(MatRef[#Layer]) > 0)
         then CreateComp( cseLAYER, Format( "fcl%g-%s", #Layer, Name ) )
         else UNDEFINED
         endif }
   "Set ConsAssm:cseFrmLAYERs[#Layer]:Parent"  for:#Layer=(1to10) ConsAssm:cseFrmLAYERs[#Layer]:Parent = {  cseFrmCONS  }
   "Set ConsAssm:cseFrmLAYERs[#Layer]:SourceCons"  for:#Layer=(1to10) ConsAssm:cseFrmLAYERs[#Layer]:SourceCons = {  Name  }

; RJH 3/18/22 - Correct layer order from Com ConsAssm Outside to Inside to CSE expected Inside to Outside
   "Set ConsAssm:cseFrmLAYERs[1]:lrMat"   ConsAssm:cseFrmLAYERs[1]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[10]) > 0) 
                                                                              then MatRef[10]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[9]) > 0)
                                                                                   then MatRef[9]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[8]) > 0)
                                                                                        then MatRef[8]:cseMATERIALRef[1]
                                                                                        else if (NumMats = 7 .AND. LocalCompAssigned(MatRef[7]) > 0)
                                                                                             then MatRef[7]:cseMATERIALRef[1]
                                                                                             else if (NumMats = 6 .AND. LocalCompAssigned(MatRef[6]) > 0)
                                                                                                  then MatRef[6]:cseMATERIALRef[1]
                                                                                                  else if (NumMats = 5 .AND. LocalCompAssigned(MatRef[5]) > 0)
                                                                                                       then MatRef[5]:cseMATERIALRef[1]
                                                                                                       else if (NumMats = 4 .AND. LocalCompAssigned(MatRef[4]) > 0)
                                                                                                            then MatRef[4]:cseMATERIALRef[1]
                                                                                                            else if (NumMats = 3 .AND. LocalCompAssigned(MatRef[3]) > 0)
                                                                                                                 then MatRef[3]:cseMATERIALRef[1]
                                                                                                                 else if (NumMats = 2 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                                                      then MatRef[2]:cseMATERIALRef[1]
                                                                                                                      else if (NumMats = 1 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                                                           then MatRef[1]:cseMATERIALRef[1]
                                                                                                                           else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[1]:lrThk"   ConsAssm:cseFrmLAYERs[1]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[10]:ResFrmThkns > 0)) then MatRef[10]:ResFrmThkns else MatRef[10]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[9]:ResFrmThkns > 0)) then MatRef[9]:ResFrmThkns else MatRef[9]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                          else if (NumMats = 2) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                               else if (NumMats = 1) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                                    else UNDEFINED
       endif endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[2]:lrMat"   ConsAssm:cseFrmLAYERs[2]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[9]) > 0) 
                                                                              then MatRef[9]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[8]) > 0)
                                                                                   then MatRef[8]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[7]) > 0)
                                                                                        then MatRef[7]:cseMATERIALRef[1]
                                                                                        else if (NumMats = 7 .AND. LocalCompAssigned(MatRef[6]) > 0)
                                                                                             then MatRef[6]:cseMATERIALRef[1]
                                                                                             else if (NumMats = 6 .AND. LocalCompAssigned(MatRef[5]) > 0)
                                                                                                  then MatRef[5]:cseMATERIALRef[1]
                                                                                                  else if (NumMats = 5 .AND. LocalCompAssigned(MatRef[4]) > 0)
                                                                                                       then MatRef[4]:cseMATERIALRef[1]
                                                                                                       else if (NumMats = 4 .AND. LocalCompAssigned(MatRef[3]) > 0)
                                                                                                            then MatRef[3]:cseMATERIALRef[1]
                                                                                                            else if (NumMats = 3 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                                                 then MatRef[2]:cseMATERIALRef[1]
                                                                                                                 else if (NumMats = 2 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                                                      then MatRef[1]:cseMATERIALRef[1]
                                                                                                                      else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[2]:lrThk"   ConsAssm:cseFrmLAYERs[2]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[9]:ResFrmThkns > 0)) then MatRef[9]:ResFrmThkns else MatRef[9]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                          else if (NumMats = 2) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                               else UNDEFINED
       endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[3]:lrMat"   ConsAssm:cseFrmLAYERs[3]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[8]) > 0) 
                                                                              then MatRef[8]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[7]) > 0)
                                                                                   then MatRef[7]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[6]) > 0)
                                                                                        then MatRef[6]:cseMATERIALRef[1]
                                                                                        else if (NumMats = 7 .AND. LocalCompAssigned(MatRef[5]) > 0)
                                                                                             then MatRef[5]:cseMATERIALRef[1]
                                                                                             else if (NumMats = 6 .AND. LocalCompAssigned(MatRef[4]) > 0)
                                                                                                  then MatRef[4]:cseMATERIALRef[1]
                                                                                                  else if (NumMats = 5 .AND. LocalCompAssigned(MatRef[3]) > 0)
                                                                                                       then MatRef[3]:cseMATERIALRef[1]
                                                                                                       else if (NumMats = 4 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                                            then MatRef[2]:cseMATERIALRef[1]
                                                                                                            else if (NumMats = 3 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                                                 then MatRef[1]:cseMATERIALRef[1]
                                                                                                                 else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[3]:lrThk"   ConsAssm:cseFrmLAYERs[3]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                          else UNDEFINED
       endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[4]:lrMat"   ConsAssm:cseFrmLAYERs[4]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[7]) > 0) 
                                                                              then MatRef[7]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[6]) > 0)
                                                                                   then MatRef[6]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[5]) > 0)
                                                                                        then MatRef[5]:cseMATERIALRef[1]
                                                                                        else if (NumMats = 7 .AND. LocalCompAssigned(MatRef[4]) > 0)
                                                                                             then MatRef[4]:cseMATERIALRef[1]
                                                                                             else if (NumMats = 6 .AND. LocalCompAssigned(MatRef[3]) > 0)
                                                                                                  then MatRef[3]:cseMATERIALRef[1]
                                                                                                  else if (NumMats = 5 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                                       then MatRef[2]:cseMATERIALRef[1]
                                                                                                       else if (NumMats = 4 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                                            then MatRef[1]:cseMATERIALRef[1]
                                                                                                            else UNDEFINED
                                                                              endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[4]:lrThk"   ConsAssm:cseFrmLAYERs[4]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                     else UNDEFINED
       endif endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[5]:lrMat"   ConsAssm:cseFrmLAYERs[5]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[6]) > 0) 
                                                                              then MatRef[6]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[5]) > 0)
                                                                                   then MatRef[5]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[4]) > 0)
                                                                                        then MatRef[4]:cseMATERIALRef[1]
                                                                                        else if (NumMats = 7 .AND. LocalCompAssigned(MatRef[3]) > 0)
                                                                                             then MatRef[3]:cseMATERIALRef[1]
                                                                                             else if (NumMats = 6 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                                  then MatRef[2]:cseMATERIALRef[1]
                                                                                                  else if (NumMats = 5 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                                       then MatRef[1]:cseMATERIALRef[1]
                                                                                                       else UNDEFINED
                                                                              endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[5]:lrThk"   ConsAssm:cseFrmLAYERs[5]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                else UNDEFINED
       endif endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[6]:lrMat"   ConsAssm:cseFrmLAYERs[6]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[5]) > 0) 
                                                                              then MatRef[5]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[4]) > 0)
                                                                                   then MatRef[4]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[3]) > 0)
                                                                                        then MatRef[3]:cseMATERIALRef[1]
                                                                                        else if (NumMats = 7 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                             then MatRef[2]:cseMATERIALRef[1]
                                                                                             else if (NumMats = 6 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                                  then MatRef[1]:cseMATERIALRef[1]
                                                                                                  else UNDEFINED
                                                                              endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[6]:lrThk"   ConsAssm:cseFrmLAYERs[6]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                           else UNDEFINED
       endif endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[7]:lrMat"   ConsAssm:cseFrmLAYERs[7]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[4]) > 0) 
                                                                              then MatRef[4]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[3]) > 0)
                                                                                   then MatRef[3]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                        then MatRef[2]:cseMATERIALRef[1]
                                                                                        else if (NumMats = 7 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                             then MatRef[1]:cseMATERIALRef[1]
                                                                                             else UNDEFINED
                                                                              endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[7]:lrThk"   ConsAssm:cseFrmLAYERs[7]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                      else UNDEFINED
       endif endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[8]:lrMat"   ConsAssm:cseFrmLAYERs[8]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[3]) > 0) 
                                                                              then MatRef[3]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[2]) > 0)
                                                                                   then MatRef[2]:cseMATERIALRef[1]
                                                                                   else if (NumMats = 8 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                        then MatRef[1]:cseMATERIALRef[1]
                                                                                        else UNDEFINED
                                                                              endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[8]:lrThk"   ConsAssm:cseFrmLAYERs[8]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                 else UNDEFINED
       endif endif endif }

   "Set ConsAssm:cseFrmLAYERs[9]:lrMat"   ConsAssm:cseFrmLAYERs[9]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[2]) > 0) 
                                                                              then MatRef[2]:cseMATERIALRef[1]
                                                                              else if (NumMats = 9 .AND. LocalCompAssigned(MatRef[1]) > 0)
                                                                                   then MatRef[1]:cseMATERIALRef[1]
                                                                                   else UNDEFINED
                                                                              endif endif }

   "Set ConsAssm:cseFrmLAYERs[9]:lrThk"   ConsAssm:cseFrmLAYERs[9]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
            else UNDEFINED
       endif endif }

   "Set ConsAssm:cseFrmLAYERs[10]:lrMat"   ConsAssm:cseFrmLAYERs[10]:lrMat  = { if (NumMats = 10 .AND. LocalCompAssigned(MatRef[1]) > 0) 
                                                                                then MatRef[1]:cseMATERIALRef[1]
                                                                                else UNDEFINED
                                                                                endif }

   "Set ConsAssm:cseFrmLAYERs[10]:lrThk"   ConsAssm:cseFrmLAYERs[10]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
       else UNDEFINED
       endif }





;   "Set ConsAssm:cseFrmLAYERs[#Layer]:lrMat"   for:#Layer=(1to10) ConsAssm:cseFrmLAYERs[#Layer]:lrMat  = {  MatRef[#Layer]:cseMATERIALRef[1]  }

;   "Set ConsAssm:cseFrmLAYERs[#Layer]:lrThk"   for:#Layer=(1to10) ConsAssm:cseFrmLAYERs[#Layer]:lrThk  = {  
;       if (IfValidAnd(MatRef[#Layer]:ResFrmThkns > 0))
;       then MatRef[#Layer]:ResFrmThkns
;       else MatRef[#Layer]:Thkns / 12 
;       endif }

END
;*************************************************************************

;*************************************************************************
RULELIST "CSE_SimulationPrep_ConsAssm_Cav"  1 0 0 1
;*************************************************************************

   "Create cseCONSTRUCTION object for this ConsAssm"     ConsAssm:cseCavCONS =
      {  CreateComp( cseCONSTRUCTION, Format( "cc-%s", Name ) )  }
   "Set ConsAssm:cseCavCONS:SourceCons"   ConsAssm:cseCavCONS:SourceCons = {  Name  }

   "Create cseLAYER objects for this ConsAssm"  for:#Layer=(1to10)   ConsAssm:cseCavLAYERs[#Layer] =
      {  if (NumMats >= #Layer .AND. LocalCompAssigned(MatRef[#Layer]) > 0)
         then CreateComp( cseLAYER, Format( "ccl%g-%s", #Layer, Name ) )
         else UNDEFINED
         endif }
   "Set ConsAssm:cseCavLAYERs[#Layer]:Parent"  for:#Layer=(1to10) ConsAssm:cseCavLAYERs[#Layer]:Parent = {  cseCavCONS  }
   "Set ConsAssm:cseCavLAYERs[#Layer]:SourceCons"  for:#Layer=(1to10) ConsAssm:cseCavLAYERs[#Layer]:SourceCons = {  Name  }

; RJH 3/18/22 - Correct layer order from Com ConsAssm Outside to Inside to CSE expected Inside to Outside
   "Set ConsAssm:cseCavLAYERs[1]:lrMat"   ConsAssm:cseCavLAYERs[1]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[10]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[10]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[10]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[10]:cseMATERIALRef[2] 
                                                                                        else MatRef[10]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[9]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[9]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[9]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[9]:cseMATERIALRef[2] 
                                                                                             else MatRef[9]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[8]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[8]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[8]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[8]:cseMATERIALRef[2] 
                                                                                             else MatRef[8]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[7]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[7]:cseMATERIALRef[2] 
                                                                                             else MatRef[7]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[2] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[2] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[2] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 3)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[2] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 2)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 1)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[1]:lrThk"   ConsAssm:cseCavLAYERs[1]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[10]:ResFrmThkns > 0)) then MatRef[10]:ResFrmThkns else MatRef[10]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[9]:ResFrmThkns > 0)) then MatRef[9]:ResFrmThkns else MatRef[9]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                          else if (NumMats = 2) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                               else if (NumMats = 1) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                                    else UNDEFINED
       endif endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[2]:lrMat"   ConsAssm:cseCavLAYERs[2]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[9]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[9]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[9]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[9]:cseMATERIALRef[2] 
                                                                                        else MatRef[9]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[8]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[8]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[8]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[8]:cseMATERIALRef[2] 
                                                                                             else MatRef[8]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[7]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[7]:cseMATERIALRef[2] 
                                                                                             else MatRef[7]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[2] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[2] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[2] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[2] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 3)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 2)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[2]:lrThk"   ConsAssm:cseCavLAYERs[2]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[9]:ResFrmThkns > 0)) then MatRef[9]:ResFrmThkns else MatRef[9]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                          else if (NumMats = 2) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                               else UNDEFINED
       endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[3]:lrMat"   ConsAssm:cseCavLAYERs[3]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[8]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[8]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[8]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[8]:cseMATERIALRef[2] 
                                                                                        else MatRef[8]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[7]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[7]:cseMATERIALRef[2] 
                                                                                             else MatRef[7]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[2] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[2] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[2] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[2] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 3)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[3]:lrThk"   ConsAssm:cseCavLAYERs[3]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                          else UNDEFINED
       endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[4]:lrMat"   ConsAssm:cseCavLAYERs[4]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[7]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[7]:cseMATERIALRef[2] 
                                                                                        else MatRef[7]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[2] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[2] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[2] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[2] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[4]:lrThk"   ConsAssm:cseCavLAYERs[4]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                     else UNDEFINED
       endif endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[5]:lrMat"   ConsAssm:cseCavLAYERs[5]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[6]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[6]:cseMATERIALRef[2] 
                                                                                        else MatRef[6]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[2] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[2] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[2] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[5]:lrThk"   ConsAssm:cseCavLAYERs[5]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                else UNDEFINED
       endif endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[6]:lrMat"   ConsAssm:cseCavLAYERs[6]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[5]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[5]:cseMATERIALRef[2] 
                                                                                        else MatRef[5]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[2] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[2] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[6]:lrThk"   ConsAssm:cseCavLAYERs[6]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                           else UNDEFINED
      endif endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[7]:lrMat"   ConsAssm:cseCavLAYERs[7]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[4]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[4]:cseMATERIALRef[2] 
                                                                                        else MatRef[4]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[2] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[7]:lrThk"   ConsAssm:cseCavLAYERs[7]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                      else UNDEFINED
      endif endif endif endif }

   "Set ConsAssm:cseCavLAYERs[8]:lrMat"   ConsAssm:cseCavLAYERs[8]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[3]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[3]:cseMATERIALRef[2] 
                                                                                        else MatRef[3]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[2] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif }

   "Set ConsAssm:cseCavLAYERs[8]:lrThk"   ConsAssm:cseCavLAYERs[8]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                 else UNDEFINED
      endif endif endif }

   "Set ConsAssm:cseCavLAYERs[9]:lrMat"   ConsAssm:cseCavLAYERs[9]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[2]:cseMATERIALRef[3]
                                                                                   else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[2] ) > 0) 
                                                                                        then MatRef[2]:cseMATERIALRef[2] 
                                                                                        else MatRef[2]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[3]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[2] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif }

   "Set ConsAssm:cseCavLAYERs[9]:lrThk"   ConsAssm:cseCavLAYERs[9]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
            else UNDEFINED
      endif endif }

   "Set ConsAssm:cseCavLAYERs[10]:lrMat"   ConsAssm:cseCavLAYERs[10]:lrMat  = { if (NumMats = 10)
                                                                                then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                     then MatRef[1]:cseMATERIALRef[3]
                                                                                     else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[2] ) > 0) 
                                                                                          then MatRef[1]:cseMATERIALRef[2] 
                                                                                          else MatRef[1]:cseMATERIALRef[1]
                                                                                     endif endif
                                                                                else UNDEFINED
                                                                                endif }

   "Set ConsAssm:cseCavLAYERs[10]:lrThk"   ConsAssm:cseCavLAYERs[10]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
       else UNDEFINED
       endif }




;   "Set ConsAssm:cseCavLAYERs[#Layer]:lrMat"   for:#Layer=(1to10) ConsAssm:cseCavLAYERs[#Layer]:lrMat  = {  
;       if (LocalCompAssigned( MatRef[#Layer]:cseMATERIALRef[3] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2
;       then  MatRef[#Layer]:cseMATERIALRef[3]
;       else if (LocalCompAssigned( MatRef[#Layer]:cseMATERIALRef[2] ) > 0)
;       then  MatRef[#Layer]:cseMATERIALRef[2]
;       else  MatRef[#Layer]:cseMATERIALRef[1]
;       endif endif }

;   "Set ConsAssm:cseCavLAYERs[#Layer]:lrThk"   for:#Layer=(1to10) ConsAssm:cseCavLAYERs[#Layer]:lrThk  = {  
;       if (IfValidAnd(MatRef[#Layer]:ResFrmThkns > 0))
;       then MatRef[#Layer]:ResFrmThkns
;       else MatRef[#Layer]:Thkns / 12 
;       endif }

END
;*************************************************************************

;*************************************************************************
RULELIST "CSE_SimulationPrep_ConsAssm_Cav_QIIDegraded"  1 0 0 1
;*************************************************************************

   "Create cseCONSTRUCTION object for this ConsAssm"     ConsAssm:cseQIIDegradedCavCONS =
      {  CreateComp( cseCONSTRUCTION, Format( "ccqiidgrd-%s", Name ) )  }
   "Set ConsAssm:cseQIIDegradedCavCONS:SourceCons"   ConsAssm:cseQIIDegradedCavCONS:SourceCons = {  Name  }

   "Create cseLAYER objects for this ConsAssm"  for:#Layer=(1to10)   ConsAssm:cseQIIDegradedCavLAYERs[#Layer] =
      {  if (NumMats >= #Layer .AND. LocalCompAssigned(MatRef[#Layer]) > 0)
         then CreateComp( cseLAYER, Format( "cclqiidgrd%g-%s", #Layer, Name ) )
         else UNDEFINED
         endif }
   "Set ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:Parent"  for:#Layer=(1to10) ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:Parent = {  cseQIIDegradedCavCONS  }
   "Set ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:SourceCons"  for:#Layer=(1to10) ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:SourceCons = {  Name  }

; RJH 3/18/22 - Correct layer order from Com ConsAssm Outside to Inside to CSE expected Inside to Outside
   "Set ConsAssm:cseQIIDegradedCavLAYERs[1]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[1]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[10]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[10]:cseMATERIALRef[5]
                                                                                   else if (LocalCompAssigned( MatRef[10]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[10]:cseMATERIALRef[4] 
                                                                                        else MatRef[10]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[9]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[9]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[9]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[9]:cseMATERIALRef[4] 
                                                                                             else MatRef[9]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[8]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[8]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[8]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[8]:cseMATERIALRef[4] 
                                                                                             else MatRef[8]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[7]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[7]:cseMATERIALRef[4] 
                                                                                             else MatRef[7]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[4] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[4] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[4] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 3)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[4] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 2)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 1)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[1]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[1]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[10]:ResFrmThkns > 0)) then MatRef[10]:ResFrmThkns else MatRef[10]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[9]:ResFrmThkns > 0)) then MatRef[9]:ResFrmThkns else MatRef[9]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                          else if (NumMats = 2) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                               else if (NumMats = 1) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                                    else UNDEFINED
       endif endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[2]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[2]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[9]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[9]:cseMATERIALRef[5]
                                                                                   else if (LocalCompAssigned( MatRef[9]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[9]:cseMATERIALRef[4] 
                                                                                        else MatRef[9]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[8]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[8]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[8]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[8]:cseMATERIALRef[4] 
                                                                                             else MatRef[8]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[7]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[7]:cseMATERIALRef[4] 
                                                                                             else MatRef[7]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[4] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[4] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[4] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[4] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 3)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 2)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[2]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[2]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[9]:ResFrmThkns > 0)) then MatRef[9]:ResFrmThkns else MatRef[9]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                          else if (NumMats = 2) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                               else UNDEFINED
       endif endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[3]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[3]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[8]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[8]:cseMATERIALRef[5]
                                                                                   else if (LocalCompAssigned( MatRef[8]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[8]:cseMATERIALRef[4] 
                                                                                        else MatRef[8]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[7]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[7]:cseMATERIALRef[4] 
                                                                                             else MatRef[7]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[4] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[4] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[4] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[4] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 3)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[3]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[3]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[8]:ResFrmThkns > 0)) then MatRef[8]:ResFrmThkns else MatRef[8]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                     else if (NumMats = 3) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                          else UNDEFINED
       endif endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[4]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[4]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[7]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[7]:cseMATERIALRef[5]
                                                                                   else if (LocalCompAssigned( MatRef[7]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[7]:cseMATERIALRef[4] 
                                                                                        else MatRef[7]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[6]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[6]:cseMATERIALRef[4] 
                                                                                             else MatRef[6]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[4] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[4] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[4] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 4)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[4]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[4]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[7]:ResFrmThkns > 0)) then MatRef[7]:ResFrmThkns else MatRef[7]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                                else if (NumMats = 4) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                     else UNDEFINED
       endif endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[5]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[5]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[6]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[6]:cseMATERIALRef[5]
                                                                                   else if (LocalCompAssigned( MatRef[6]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[6]:cseMATERIALRef[4] 
                                                                                        else MatRef[6]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[5]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[5]:cseMATERIALRef[4] 
                                                                                             else MatRef[5]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[4] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[4] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 5)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[5]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[5]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[6]:ResFrmThkns > 0)) then MatRef[6]:ResFrmThkns else MatRef[6]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                           else if (NumMats = 5) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                                else UNDEFINED
       endif endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[6]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[6]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[5]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[5]:cseMATERIALRef[5]
                                                                                   else if (LocalCompAssigned( MatRef[5]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[5]:cseMATERIALRef[4] 
                                                                                        else MatRef[5]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[4]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[4]:cseMATERIALRef[4] 
                                                                                             else MatRef[4]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[4] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 6)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[6]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[6]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[5]:ResFrmThkns > 0)) then MatRef[5]:ResFrmThkns else MatRef[5]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                      else if (NumMats = 6) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                           else UNDEFINED
       endif endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[7]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[7]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[4]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[5]:cseMATERIALRef[4]
                                                                                   else if (LocalCompAssigned( MatRef[4]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[4]:cseMATERIALRef[4] 
                                                                                        else MatRef[4]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[3]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[3]:cseMATERIALRef[4] 
                                                                                             else MatRef[3]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 7)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[7]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[7]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[4]:ResFrmThkns > 0)) then MatRef[4]:ResFrmThkns else MatRef[4]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
                 else if (NumMats = 7) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                      else UNDEFINED
       endif endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[8]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[8]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[3]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[3]:cseMATERIALRef[4]
                                                                                   else if (LocalCompAssigned( MatRef[3]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[3]:cseMATERIALRef[4] 
                                                                                        else MatRef[3]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[2]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[2]:cseMATERIALRef[4] 
                                                                                             else MatRef[2]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else if (NumMats = 8)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[8]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[8]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[3]:ResFrmThkns > 0)) then MatRef[3]:ResFrmThkns else MatRef[3]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
            else if (NumMats = 8) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
                 else UNDEFINED
       endif endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[9]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[9]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[2]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[2]:cseMATERIALRef[4]
                                                                                   else if (LocalCompAssigned( MatRef[2]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[2]:cseMATERIALRef[4] 
                                                                                        else MatRef[2]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else if (NumMats = 9)
                                                                                   then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                        then MatRef[1]:cseMATERIALRef[5]
                                                                                        else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                             then MatRef[1]:cseMATERIALRef[4] 
                                                                                             else MatRef[1]:cseMATERIALRef[1]
                                                                                        endif endif
                                                                              else UNDEFINED
                                                                              endif endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[9]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[9]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[2]:ResFrmThkns > 0)) then MatRef[2]:ResFrmThkns else MatRef[2]:Thkns / 12 endif
       else if (NumMats = 9) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
            else UNDEFINED
       endif endif }
   "Set ConsAssm:cseQIIDegradedCavLAYERs[10]:lrMat"   ConsAssm:cseQIIDegradedCavLAYERs[10]:lrMat  = { if (NumMats = 10)
                                                                              then if (LocalCompAssigned(MatRef[1]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2 
                                                                                   then MatRef[1]:cseMATERIALRef[4]
                                                                                   else if (LocalCompAssigned( MatRef[1]:cseMATERIALRef[4] ) > 0) 
                                                                                        then MatRef[1]:cseMATERIALRef[4] 
                                                                                        else MatRef[1]:cseMATERIALRef[1]
                                                                                   endif endif
                                                                              else UNDEFINED
                                                                              endif }

   "Set ConsAssm:cseQIIDegradedCavLAYERs[10]:lrThk"   ConsAssm:cseQIIDegradedCavLAYERs[10]:lrThk  = {  
       if (NumMats = 10) then if (IfValidAnd(MatRef[1]:ResFrmThkns > 0)) then MatRef[1]:ResFrmThkns else MatRef[1]:Thkns / 12 endif
       else UNDEFINED
       endif }






;   "Set ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:lrMat"   for:#Layer=(1to10) ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:lrMat  = {  
;       if (LocalCompAssigned( MatRef[#Layer]:cseMATERIALRef[5] ) > 0 .AND. (CompatibleSurfType == "Ceiling" .OR. CompatibleSurfType == "Roof")) ; 7 or 2
;       then  MatRef[#Layer]:cseMATERIALRef[5]
;       else if (LocalCompAssigned( MatRef[#Layer]:cseMATERIALRef[4] ) > 0)
;       then  MatRef[#Layer]:cseMATERIALRef[4]
;       else  MatRef[#Layer]:cseMATERIALRef[1]
;       endif endif }

;   "Set ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:lrThk"   for:#Layer=(1to10) ConsAssm:cseQIIDegradedCavLAYERs[#Layer]:lrThk  = {  
;       if (IfValidAnd(MatRef[#Layer]:ResFrmThkns > 0))
;       then MatRef[#Layer]:ResFrmThkns
;       else MatRef[#Layer]:Thkns / 12 
;       endif }

END
;*************************************************************************


;*************************************************************************
;*************************************************************************

ENDFILE
