// HVAC Secondary Systems - Fan - Pressure Credits
//
// -------------------------------------------------------------------------
//  Copyright (c) 2013-2017, California Energy Commission
//  All rights reserved.
//  Redistribution and use in source and binary forms, with or without
//  modification, are permitted provided that the following conditions are
//  met:
// 
//    * Redistributions of source code must retain the above copyright
//  notice, this list of conditions and the following disclaimer.
//    * Redistributions in binary form must reproduce the above copyright
//  notice, this list of conditions and the following disclaimer in
//  the documentation and/or other materials provided with the
//  distribution.
//    * Neither the name of the California Energy Commission nor the names of its
//  contributors may be used to endorse or promote products
//  derived from this software without specific prior written
//  permission.
//
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
//  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
//  TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
//  PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION
//  BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
//  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
//  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
//  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
//  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
//  OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
//  ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
// -------------------------------------------------------------------------



RULE NEW Proj:PDDevFlowTol
  DATATYPE
    Float
  LONGFORM
    PressureDropDeviceFlowTolerance
  INPUTCLASS
    NotInput
  DESCRIPTION
    "The amount of flow the device flow can exceed the system flow."
  UNITS
    cfm
  DEFAULT
    10
ENDRULE

// Whether system is multizone or all-other for 2022 fan power adjustment rules
// See Ticket 3323
RULE NEW Proj:FanPwrIdxAdjNormPD
  DATATYPE
    Float
  LONGFORM
    FanPowerIndexAdjustmentNormalizedPressureDrop
  DESCRIPTION
    "The pressure drop to which power index adjustments are normailized to."
  INPUTCLASS 
    NotInput
  UNITS
    inH2O
  DEFAULT
    1.0
ENDRULE

// ********** Fan System Type *************************************************
RULE NEW AirSys:FanSysType
  DATATYPE
    Enumeration
  LONGFORM
    FanSystemType
  DESCRIPTION
    "An integer flag that indicates the system qualifies as a multi-zone VAV fan system."
  HELP
    "FAN SYSTEM, MULTI-ZONE VARIABLE AIR VOLUME (VAV) is a fan system that serves 
     three or more space-conditioning zones where airflow to each zone is individually
     controlled based on heating, cooling and/or ventilation requirements, indoor fan
     airflow varies as a function of load, and the sum of the minimum zone airflows for
     each zone is 40% or less of the fan system design conditions."
  INPUTCLASS 
    NotInput
  OPTION
    MultiZoneVAV
    AllOther
  DEFAULT : T24N_2016 T24N_2019
    UNDEFINED
  DEFAULT : T24N
    if( IfValidAnd( IsExhSys > 0 ) )
    then "AllOther"
    else
    if( ( Type = "PVAV" .OR. Type = "VAV" .OR. Type = "DOASVAV" ) .AND. 
        IfValidAnd( SupFanCap > 0 ) )
    then // Is a VAV system, check that it meets other reqs
      if( ( SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:HVACZnCnt ) > 3 .OR.
            SumRevRef( ThrmlZn:PriAirCondgSysRef[2], ThrmlZn:HVACZnCnt ) > 3 .OR. 
            SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:HVACZnCnt ) > 3 ) .AND.
          ( ValidOr( TotTrmlPriAirFlowMinSim, 0 ) / ValidOr( Cnt, 1 ) / SupFanCap ) < 0.4 )
      then "MultiZoneVAV"
      else "AllOther"
      endif
    else "AllOther"
    endif endif
  ANNUAL : T24N_2016 T24N_2019
    UNDEFINED
  ANNUAL : T24N
    if( BaseSysNum > 0 ) 
    then 
      if( ( Type = "PVAV" .OR. Type = "VAV" .OR. Type = "DOASVAV" ) .AND. 
          IfValidAnd( SupFanCap > 0 ) )
      then // Is a VAV system, check that it meets other reqs
        if( ( SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:HVACZnCnt ) > 3 .OR.
              SumRevRef( ThrmlZn:PriAirCondgSysRef[2], ThrmlZn:HVACZnCnt ) > 3 .OR. 
              SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:HVACZnCnt ) > 3 ) .AND.
            ( ValidOr( TotTrmlPriAirFlowMinSim, 0 ) / ValidOr( Cnt, 1 ) / SupFanCap ) < 0.4 )
        then "MultiZoneVAV"
        else "AllOther"
        endif
      else "AllOther"
      endif
    else UNCHANGED
    endif        
ENDRULE
RULE NEW ZnSys:FanSysType
  DATATYPE
    Enumeration
  LONGFORM
    FanSystemType
  DESCRIPTION
    "An integer flag that indicates the system qualifies as a multi-zone VAV fan system."
  HELP
    "FAN SYSTEM, MULTI-ZONE VARIABLE AIR VOLUME (VAV) is a fan system that serves 
     three or more space-conditioning zones where airflow to each zone is individually
     controlled based on heating, cooling and/or ventilation requirements, indoor fan
     airflow varies as a function of load, and the sum of the minimum zone airflows for
     each zone is 40% or less of the fan system design conditions."
  INPUTCLASS 
    NotInput
  OPTION
    MultiZoneVAV
    AllOther
  DEFAULT : T24N_2016 T24N_2019
    UNDEFINED
  DEFAULT : T24N
    "AllOther" // ZnSys is not multi-zone.
  DEFAULT : T24N_2016 T24N_2019
    UNDEFINED
  ANNUAL : T24N
    if( BaseSysNum > 0 ) 
    then "AllOther"
    else UNCHANGED
    endif    
ENDRULE

// ********** Baseline Energy Recovery Fan Power Adjustment *******************
// Set parameters to determine 2022 NonRes heat recovery requirement
// See ticket 3317
// =========================== AirSystem ======================================
RULE NEW AirSys:AnnualOperHrs
  DESCRIPTION
    "The number of hours the system operates per year."
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    Hours
  ANNUAL : T24N
    switch( AvailSchRef ) // Hours are depending on the prescribed HVAC schedule
      case "AssemblyHVACAvail"           :  5840
      case "DataHVACAvail"               :  8760
      case "HealthHVACAvail"             :  5250
      case "LabHVACAvail"                :  8760
      case "ManufacturingHVACAvail"      :  6303
      case "OfficeHVACAvail"             :  5497
      case "ParkingHVACAvail"            :  8760
      case "ResidentialCommonHVACAvail"  :  8760
      case "ResidentialLivingHVACAvail"  :  8760
      case "RestaurantHVACAvail"         :  7375
      case "RetailHVACAvail"             :  5279
      case "SchoolHVACAvail"             :  4328
      case "WarehouseHVACAvail"          :  3229
      case "AllOnHVACAvail"              :  8760
      default                            :  0
    endswitch
ENDRULE
RULE NEW AirSys:HtRcvryReqThreshold
  DESCRIPTION
    "Design supply air flow threshold for requiring heat recovery."
  HELP
    "Requiement for threshold based on climate zone, number of operating hours, and outside air ratio.
     Heat recovery can only be modeled for AirSystems, so there is no corresponding criteria for 
     ZoneSystems."
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    cfm
  ANNUAL : T24N_2016 T24N_2019
    -1 // Heat recovery not required prior to 2022.
  ANNUAL : T24N
    if( IfValidAnd( SupFanCap > 0 ) .AND.
        IfValidAnd( SysVentFlow > 0 ) )
    then PrescriptiveHtRcvryReqs:SupFlowThreshold( 
         "AnnualOperHrs", AnnualOperHrs, "OAFlowRat", SysOARat, "ClimateZone", Proj:CliZnNum )
    else 0
    endif
ENDRULE
RULE NEW AirSys:PrescriptiveHtRcvryReq
  DESCRIPTION
    "A flag that indicates if heat recovery is required if using prescriptive approach"
  DATATYPE
    Integer
  INPUTCLASS
    NotInput
  ANNUAL : T24N_2016 T24N_2019
    0 // Heat recovery not required prior to 2022.
  ANNUAL : T24N
    if( IsResSys > 0 .OR. LabArea > 0 ) 
    then 0 // Heat recovery is not required for Res, Lab per 140.4(6) Exception 1 
    else
    if( CommKitArea > 0 ) 
    then 0 // Heat recovery is not required for CommKit per 3/17 call with CEC, see ticket 3356
    else
    if( IfValidAnd( HtRcvryReqThreshold > 0 ) .AND.
        IfValidAnd( SupFanCap > HtRcvryReqThreshold ) )
    then 1 // Heat recovery is required
    else 0
    endif endif endif
ENDRULE
RULE NEW AirSys:BaseERVSupPwrAdj
  DATATYPE
    Float
  LONGFORM
    BaselineEnergyRecoveryVentilatorSupplyPowerAdjustment
  DESCRIPTION
    "The total supply allowance to be added to the baseline design
     if it requires heat recovery."
  UNITS 
    kW
  INPUTCLASS
    NotInput
  ANNUAL : T24N_2016 T24N_2019
    0 // Heat recovery not required prior to 2022.
  ANNUAL : T24N
    if( BaseSysNum > 0 .AND. PrescriptiveHtRcvryReq > 0 )
    then
      if( IfValidAnd( SupFanCap > 0 ) .AND.
          IfValidAnd( SysVentFlow > 0 ) .AND.
          LocalStatus( FanSysType ) > 0 )
      then 
        ( T24N_2022FanPwrIdxAdj:ERVSupply( "SysType", FanSysType,
                                           "FlowCap", SysVentFlow ) * SysVentFlow ) / 1000
      else 0
      endif      
    else 0
    endif
ENDRULE
RULE NEW AirSys:BaseERVRetPwrAdj
  DATATYPE
    Float
  LONGFORM
    BaselineEnergyRecoveryVentilatorReturnPowerAdjustment
  DESCRIPTION
    "The total return (plus filter) allowance to be added to the baseline design
     if it requires heat recovery."
  UNITS 
    kW
  INPUTCLASS
    NotInput
  ANNUAL : T24N_2016 T24N_2019
    0 // Heat recovery not required prior to 2022.
  ANNUAL : T24N
    if( BaseSysNum > 0 .AND. PrescriptiveHtRcvryReq > 0 )
    then
      if( IfValidAnd( SupFanCap > 0 ) .AND.
          IfValidAnd( SysVentFlow > 0 ) .AND.
          LocalStatus( FanSysType ) > 0 )
      then 
        ( T24N_2022FanPwrIdxAdj:ERVReturn( "SysType", FanSysType,
                                           "FlowCap", SysVentFlow ) * SysVentFlow +
          T24N_2022FanPwrIdxAdj:RetFilter( "SysType", FanSysType,
                                           "FlowCap", SysVentFlow ) * SysVentFlow ) / 1000
      else 0
      endif      
    else 0
    endif
ENDRULE
RULE NEW AirSys:BaseERVPwrAdj
  DATATYPE
    Float
  LONGFORM
    BaselineEnergyRecoveryVentilatorPowerAdjustment
  DESCRIPTION
    "The total supply + return (plus filter) allowance to be added to the baseline design
     if it requires heat recovery."
  UNITS 
    kW
  INPUTCLASS
    NotInput
  ANNUAL : T24N_2016 T24N_2019
    0 // Heat recovery not required prior to 2022.
  ANNUAL : T24N
    BaseERVSupPwrAdj + BaseERVRetPwrAdj
ENDRULE

// =========================== ZoneSystem =====================================
RULE NEW ZnSys:BaseERVPwrAdj
  DATATYPE
    Float
  LONGFORM
    BaselineEnergyRecoveryVentilatorPowerAdjustment
  DESCRIPTION
    "The total supply + return (plus filter) allowance to be added to the baseline design
     if it requires heat recovery."
  HELP
    "Standard design does not use ZnSys for any cases that would include heat recovery, so 
     this is 0."
  UNITS 
    kW
  INPUTCLASS
    NotInput
  ANNUAL : T24N
    0
ENDRULE

// Flag to indicate that PD adjustments are allowed for the given system
// For screens and CHECK rules
// AirSys
RULE NEW AirSys:NonExhPDAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    NonExhaustPressureDropAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the PD adjustments are allowed.
     For non-exhaust systems."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:PriAirCondgSysRef[2], ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) ) > 0 .OR.
        ServesResZn > 0 .OR. IsHlthCareSys > 0 )
    then 0 // Filter out Res systems from this criteria. Certain credits for Res systems added back below 
    else
    if( Type != "Exhaust" .AND. Type != "VentilationOnly" )
    then 1
    else 0
    endif endif
ENDRULE
RULE NEW AirSys:ExhPDAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    ExhaustPressureDropAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the PD adjustments are allowed.
     For exhaust systems."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:ExhSysRef, ThrmlZn:IsRes ) ) > 0 .OR.
        ServesResZn > 0 .OR. IsHlthCareSys > 0 )
    then 0 // Filter out Res systems from this criteria. Certain credits for Res systems added back below
    else 
    if( Type = "Exhaust" )
    then 1  
    else 0
    endif endif
ENDRULE

// ZnSys
RULE NEW ZnSys:NonExhPDAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    NonExhaustPressureDropAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the PD adjustments are allowed."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:PriAirCondgSysRef[2], ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) ) > 0
          .OR. IsHlthCareSys > 0 )
    then 0 // Filter out Res systems from this criteria. Certain credits for Res systems added back below 
    else
    if( Type = "PTAC" .OR.
        Type = "PTHP" .OR.
        Type = "Furnace" .OR.
        Type = "Baseboard" .OR.
        Type = "PassiveBeam" .OR.
        Type = "VRF" .OR.       
        Type = "MiniSplitAC" .OR.
        Type = "MiniSplitHP" .OR.
        Type = "Exhaust" .OR.
        Type = "VentilationOnly" )
    then 0
    else 1
    endif endif
ENDRULE
RULE NEW ZnSys:ExhPDAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    ExhaustPressureDropAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the PD adjustments are allowed.
     For exhaust systems."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:ExhSysRef, ThrmlZn:IsRes ) ) > 0
          .OR. IsHlthCareSys > 0 )
    then 0 // Filter out Res systems from this criteria. Certain credits for Res systems added back below 
    else
    if( Type = "Exhaust" )
    then 1
    else 0
    endif endif
ENDRULE

// Special rules for handling specific adjustments
// TO DO: Add ***Allowed properties for each adjustment and remove the NonExh and Exh** properties
// above to facilitate screen management. Below are 3 examples

// AirSys
RULE NEW AirSys:MERVGTE16AdjAllowed
  DATATYPE
    Integer
  LONGFORM
    MERVGreaterThan16AdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the MERVGTE16 PD adjustment is allowed."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:PriAirCondgSysRef[2], ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) ) > 0 .OR.
        ServesResZn > 0 .OR. IsHlthCareSys > 0 )
    then 0
    else
    if( Type != "Exhaust" .AND. Type != "VentilationOnly" )
    then 1
    else 0
    endif endif
ENDRULE
RULE NEW AirSys:FullyDuctedExhAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    FullyDuctedExhaustAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the FullyDuctedExh PD adjustment is allowed."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:ExhSysRef, ThrmlZn:IsRes ) ) > 0 .OR.
        ServesResZn > 0 .OR. IsHlthCareSys > 0 )
    then 0
    else
    if( Type = "Exhaust" )
    then
      if( LabArea > 0 .AND. Bldg:LabExhFlow > 10000 )
      then 0
      else 1
      endif
    else 0
    endif endif
ENDRULE
RULE NEW AirSys:BiosftyCabExhAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    BiosafetyCabinetAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the BiosftyCabExh PD adjustment is allowed."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:ExhSysRef, ThrmlZn:IsRes ) ) > 0 .OR.
        ServesResZn > 0 .OR. IsHlthCareSys > 0 )
    then 0
    else
    if( Type = "Exhaust" )
    then
      if( LabArea > 0 .AND. Bldg:LabExhFlow > 10000 )
      then 0
      else 1
      endif
    else 0
    endif endif
ENDRULE
// ZnSys
RULE NEW ZnSys:MERVGTE16AdjAllowed
  DATATYPE
    Integer
  LONGFORM
    MERVGreaterThan16AdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the MERVGTE16 PD adjustment is allowed."
  DEFAULT
    if( Type = "PTAC" .OR.
        Type = "PTHP" .OR.
        Type = "Furnace" .OR.
        Type = "Baseboard" .OR.
        Type = "PassiveBeam" .OR.
        Type = "VRF" .OR.       
        Type = "MiniSplitAC" .OR.
        Type = "MiniSplitHP" .OR.
        Type = "Exhaust" .OR.
        Type = "VentilationOnly" .OR. 
        IsHlthCareSys > 0 )
    then 0
    else 1
    endif
ENDRULE
RULE NEW ZnSys:FullyDuctedExhAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    FullyDuctedExhaustAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the FullyDuctedExh PD adjustment is allowed."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:ExhSysRef, ThrmlZn:IsRes ) ) > 0
          .OR. IsHlthCareSys > 0 )
    then 0
    else
    if( Type = "Exhaust" )
    then
      if( LabArea > 0 .AND. Bldg:LabExhFlow > 10000 )
      then 0
      else 1
      endif
    else 0
    endif endif
ENDRULE
RULE NEW ZnSys:BiosftyCabExhAdjAllowed
  DATATYPE
    Integer
  LONGFORM
    BiosafetyCabinetAdjustmentAllowed
  INPUTCLASS
    NotInput
  DESCRIPTION
    "A flag that indicates whether the BiosftyCabExh PD adjustment is allowed."
  DEFAULT
    if( ( SumRevRef( ThrmlZn:VentSysRef, ThrmlZn:IsRes ) + 
          SumRevRef( ThrmlZn:ExhSysRef, ThrmlZn:IsRes ) ) > 0
          .OR. IsHlthCareSys > 0 )
    then 0
    else
    if( Type = "Exhaust" )
    then
      if( LabArea > 0 .AND. Bldg:LabExhFlow > 10000 )
      then 0
      else 1
      endif
    else 0
    endif endif
ENDRULE


// ********** Pressure Drop Adjustments ***************************************
// Input rules
// =========================== AirSystem ======================================
// *************************** Exhaust Systems ********************************

// ---------- Fully Ducted Exhaust --------------------------------------------
RULE AirSys:FullyDuctedExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with fully ducted 
     exhaust."  
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( FullyDuctedExhFlag, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedExhPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for fully ducted exhaust."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedExhFlag )
    case 1 : 0.5
    default: 0
    endswitch
  SIZING
    ValidOr( FullyDuctedExhPDAdj, 0 )
ENDRULE
RULE AirSys:FullyDuctedExhDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( FullyDuctedExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedExhDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Fully ducted exhaust air systems' fan pressure credit 
                (%.0f cfm) exceeds the total system exhaust fan flow
                (%.0f cfm).  Revise inputs for consistency.",
                Name, FullyDuctedExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( FullyDuctedExhDevFlow, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for fully ducted exhaust."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( FullyDuctedExhFlag > 0 ) .AND.
        IfValidAnd( FullyDuctedExhDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:FullyDuctedExh( "SysType", FanSysType,
                                            "FlowCap", FullyDuctedExhDevFlow )
    else 0
    endif
  SIZING
    ValidOr( FullyDuctedExhPwrIdxAdj, 0 )
ENDRULE

// ---------- Exhaust Airflow Control Device---------------------------------
RULE AirSys:ExhCtrlFlag
  DESCRIPTION
    "A flag to indicate that the proposed system has an exhaust airflow 
     control device."  
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
  SIZING
    ValidOr( ExhCtrlFlag, 0 )
ENDRULE
RULE NEW AirSys:ExhCtrlPDAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustControlPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for the an exhaust airflow 
     control device."      
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ExhCtrlFlag )
    case 1 : 0.5
    default: 0
    endswitch
  SIZING
    ValidOr( ExhCtrlPDAdj, 0 )
ENDRULE
RULE AirSys:ExhCtrlDevFlow
  DESCRIPTION
    "The airflow through the exhaust airflow control device."        
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( ExhCtrlFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ExhCtrlDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then 
      PostError("For Exhaust System '%s': The input device flow for the 
                exhaust airflow control device fan pressure credit 
                (%.0f cfm) exceeds the total system exhaust fan flow
                (%.0f cfm).  Revise inputs for consistency.",
                Name, ExhCtrlDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( ExhCtrlDevFlow, 0 )
ENDRULE
RULE NEW AirSys:ExhCtrlPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustControlPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for exhaust control device."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Fully Ducted Exhaust - Laboratory or Vivarium -------------------
RULE AirSys:FullyDuctedExhLabOrVivFlag
  DESCRIPTION
    "A flag to indicate that the proposed system serves a laboratory or
     vivarium, and is provided with fully ducted exhaust systems."  
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
  SIZING
    ValidOr( FullyDuctedExhLabOrVivFlag, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedExhLabOrVivPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment of fully ducted exhaust for systems 
     serving Laboratory or Vivarium spaces."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedExhLabOrVivFlag )
    case 1 : 2.15
    default: 0
    endswitch
  SIZING
    ValidOr( FullyDuctedExhLabOrVivPDAdj, 0 )
ENDRULE
RULE AirSys:FullyDuctedExhLabOrVivDevFlow
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( FullyDuctedExhLabOrVivFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedExhLabOrVivDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Fully ducted exhaust air systems, lab or viavarium' fan 
                pressure credit (%.0f cfm) exceeds the total system exhaust 
                fan flow (%.0f cfm).  Revise inputs for consistency.",
                Name, FullyDuctedExhLabOrVivDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( FullyDuctedExhLabOrVivDevFlow, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedExhLabOrVivPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment of fully ducted exhaust for systems 
     serving Laboratory or Vivarium spaces." 
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Exhaust filters, scrubbers, or other exhaust treatment ----------
RULE AirSys:ExhFiltersFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with exhaust 
     filters, scrubbers, or other exhaust treatment."  
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( ExhFiltersFlag, 0 )
ENDRULE
RULE AirSys:ExhFiltersDsgnPD
  DESCRIPTION
    "The design pressure drop of the exhaust treatment, at fan system design
     conditions."  
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( ExhFiltersDsgnPD, 0 )
ENDRULE
RULE NEW AirSys:ExhFiltersPDAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for exhaust filters, scrubbers, 
     or other exhaust treatment."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ExhFiltersFlag )
    case 1 : ExhFiltersDsgnPD
    default: 0
    endswitch
  SIZING
    ValidOr( ExhFiltersPDAdj, 0 )
ENDRULE
RULE AirSys:ExhFiltersDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( ExhFiltersFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ExhFiltersDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Exhaust filters, scrubbers, or other exhaust treatment' 
                fan pressure credit (%.0f cfm) exceeds the
                total system exhaust fan flow (%.0f cfm).  Revise inputs for 
                consistency.",
                Name, ExhFiltersDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( ExhFiltersDevFlow, 0 )
ENDRULE
RULE NEW AirSys:ExhFiltersPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for exhaust filters, scrubbers, 
     or other exhaust treatment."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( ExhFiltersFlag > 0 ) .AND.
        IfValidAnd( ExhFiltersDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:ExhFilters( "SysType", FanSysType,
                                        "FlowCap", ExhFiltersDevFlow ) *
      ( ExhFiltersDsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( ExhFiltersPwrIdxAdj, 0 )
ENDRULE
// Value used to determine baseline fan power based on proposed inclusion of ExhFilters 
RULE NEW AirSys:ExhFiltersPwrAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT : T24N_2019
    if( IsExhSys > 0 .AND. 
        IfValidAnd( LabArea > 0 ) .AND.
        IfValidAnd( ExhSysType = "Laboratory" ) .AND.
        ExhFiltersFlag > 0 )
    then 
      ExhFiltersPDAdj * ExhFiltersDevFlow * ( 0.1175 / 745.6 ) / 0.65
    else 0
    endif
  DEFAULT : T24N
    if( IsExhSys > 0 .AND. 
        IfValidAnd( LabArea > 0 ) .AND.
        IfValidAnd( ExhSysType = "Laboratory" ) .AND.
        ExhFiltersFlag > 0 )
    then 
      ExhFiltersDevFlow * ExhFiltersPwrIdxAdj / 1000
    else 0
    endif
  SIZING
    ValidOr( ExhFiltersPwrAdj, 0 )
ENDRULE

// ---------- Biosafety Cabinet -----------------------------------------------
RULE AirSys:BiosftyCabExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed systems is an exhaust system serving
     a biosafety cabinet."
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( BiosftyCabExhFlag, 0 )
ENDRULE
RULE AirSys:BiosftyCabExhDsgnPD
  DESCRIPTION
    "The design pressure drop of the biosafety cabinet, at fan system design 
     conditions."  
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( BiosftyCabExhDsgnPD, 0 )
ENDRULE
RULE NEW AirSys:BiosftyCabExhPDAdj
  DATATYPE
    Float
  LONGFORM
    BiosafetyCabinetExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for biosafety cabinets."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( BiosftyCabExhFlag )
    case 1 : BiosftyCabExhDsgnPD
    default: 0
    endswitch
  SIZING
    ValidOr( BiosftyCabExhPDAdj, 0 )
ENDRULE
RULE AirSys:BiosftyCabExhDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( BiosftyCabExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ExhFiltersDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Biosafety Cabinet' fan pressure credit (%.0f cfm) exceeds 
                 the total system exhaust fan flow (%.0f cfm).  Revise inputs
                 for consistency.",
                 Name, BiosftyCabExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( BiosftyCabExhDevFlow, 0 )
ENDRULE
RULE NEW AirSys:BiosftyCabExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    BiosafetyCabinetExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for biosafety cabinets."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( BiosftyCabExhFlag > 0 ) .AND.
        IfValidAnd( BiosftyCabExhDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:BiosftyCabExh( "SysType", FanSysType,
                                           "FlowCap", BiosftyCabExhDevFlow ) *
      ( BiosftyCabExhDsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( BiosftyCabExhPwrIdxAdj, 0 )
ENDRULE

// ---------- Exhaust system serving fume hood --------------------------------
RULE AirSys:FumeHoodExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is an exhaust system serving
     a fume hood."
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
  SIZING
    ValidOr( FumeHoodExhFlag, 0 )
ENDRULE
RULE NEW AirSys:FumeHoodExhPDAdj
  DATATYPE
    Float
  LONGFORM
    FumeHoodExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for exhaust system serving fume hood."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FumeHoodExhFlag )
    case 1 : 0.35
    default: 0
    endswitch
  SIZING
    ValidOr( FumeHoodExhPDAdj, 0 )
ENDRULE
RULE AirSys:FumeHoodExhDevFlow
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( FumeHoodExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FumeHoodExhDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Exhaust system serving fume hood' fan pressure credit 
                (%.0f cfm) exceeds the total system exhaust fan flow (%.0f cfm).  
                Revise inputs for consistency.",
                Name, FumeHoodExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( FumeHoodExhDevFlow, 0 )
ENDRULE
RULE NEW AirSys:FumeHoodExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FumeHoodExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for exhaust system serving fume hood."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Laboratory and vivarium exhaust systems in high-rise buildings ---
// Not Used for T24N
RULE AirSys:LabOrVivExhHiRiseFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is an exhaust system serving a
     laboratory or vivarium and located in a high-rise building."
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( LabOrVivExhHiRiseFlag, 0 )
ENDRULE
RULE AirSys:LabOrVivExhHiRiseVertDuctLen
  DESCRIPTION
    "The vertical duct length of the Lab/Vivarium exhaust system."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( LabOrVivExhHiRiseVertDuctLen, 0 )
ENDRULE
RULE NEW AirSys:LabOrVivExhHiRisePDAdj
  DATATYPE
    Float
  LONGFORM
    LabOrVivariumExhaustHighRisePressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for laboratory and vivarium
     exhaust systems in high-rise buildings."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( LabOrVivExhHiRiseFlag )
    case 1 : 0.25 * Max(0, ( LabOrVivExhHiRiseVertDuctLen - 75 ) / 100 )
    default: 0
    endswitch
  SIZING
    ValidOr( LabOrVivExhHiRisePDAdj, 0 )
ENDRULE
RULE AirSys:LabOrVivExhHiRiseDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( LabOrVivExhHiRiseFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( LabOrVivExhHiRiseDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Laboratory and vivarium exhaust systems in high-rise 
                buildings' fan pressure credit (%.0f cfm) exceeds the total 
                system exhaust fan flow (%.0f cfm).  Revise inputs for 
                consistency.",
                Name, LabOrVivExhHiRiseDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( LabOrVivExhHiRiseDevFlow, 0 )
ENDRULE
RULE NEW AirSys:LabOrVivExhHiRisePwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    LabOrVivariumExhaustHighRisePowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for laboratory and vivarium
     exhaust systems in high-rise buildings."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
      
// ---------- Sound Attenuation Section For Exhaust----------------------------
// Not Used for T24N
RULE AirSys:SndAttnExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed exhaust system is provided with a
     sound attenuation section."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( SndAttnExhFlag, 0 )
ENDRULE
RULE NEW AirSys:SndAttnExhPDAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for the sound attenuation section."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( SndAttnExhFlag )
    case 1 : 0.15
    default: 0
    endswitch
  SIZING
    ValidOr( SndAttnExhPDAdj, 0 )
ENDRULE
RULE AirSys:SndAttnExhDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( SndAttnExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( SndAttnExhDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Sound Attenuation Section' fan pressure credit (%.0f cfm) 
                exceeds the total system exhaust fan flow (%.0f cfm).  
                Revise inputs for consistency.",
                Name, SndAttnExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( SndAttnExhDevFlow, 0 )
ENDRULE
RULE NEW AirSys:SndAttnExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for the sound attenuation section."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE


// *************************** Supply/Return Systems *************************
// ---------- Fully Ducted Return ---------------------------------------------
RULE AirSys:FullyDuctedRetFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with fully ducted 
     return."  
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( FullyDuctedRetFlag, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedRetPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for fully ducted return."      
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedRetFlag )
    case 1 : 0.5
    default: 0
    endswitch
  SIZING
    ValidOr( FullyDuctedRetPDAdj, 0 )
ENDRULE
RULE AirSys:FullyDuctedRetDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( FullyDuctedRetFlag )
    case 1 : ValidOr( RetFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedRetDevFlow > RetFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Fully ducted return systems' fan pressure credit (%.0f cfm) 
                exceeds the system return fan flow (%.0f cfm).  Revise 
                inputs for consistency.",
                Name, FullyDuctedRetDevFlow, RetFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( FullyDuctedRetDevFlow, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedRetPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for fully ducted return."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( FullyDuctedRetFlag > 0 ) .AND.
        IfValidAnd( FullyDuctedRetDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:FullyDuctedRet( "SysType", FanSysType,
                                            "FlowCap", FullyDuctedRetDevFlow )
    else 0
    endif
  SIZING
    ValidOr( FullyDuctedRetPwrIdxAdj, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedRetFlowRat
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustFlowRatio  
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedRetFlag )
    case 1 : FullyDuctedRetDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( FullyDuctedRetFlowRat, 0 )
ENDRULE

// ---------- Return Airflow Control Device---------------------------------
RULE AirSys:RetCtrlFlag
  DESCRIPTION
    "A flag to indicate that the proposed system has a return airflow 
     control device."    
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
  SIZING
    ValidOr( RetCtrlFlag, 0 )
ENDRULE
RULE NEW AirSys:RetCtrlPDAdj
  DATATYPE
    Float
  LONGFORM
    ReturnControlPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for the return airflow 
     control device."      
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( RetCtrlFlag )
    case 1 : 0.5
    default: 0
    endswitch
  SIZING
    ValidOr(RetCtrlPDAdj, 0 )
ENDRULE
RULE AirSys:RetCtrlDevFlow
  DESCRIPTION
    "The airflow through the return airflow control device."        
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( RetCtrlFlag )
    case 1 : ValidOr( RetFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( RetCtrlDevFlow > RetFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Air System '%s': The input device flow for the 
                return airflow control device fan pressure credit 
                (%.0f cfm) exceeds the total system return fan flow
                (%.0f cfm).  Revise inputs for consistency.",
                Name, RetCtrlDevFlow, RetFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( RetCtrlDevFlow, 0 )
ENDRULE
RULE NEW AirSys:RetCtrlPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    ReturnControlPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for the return airflow 
     control device." 
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
RULE NEW AirSys:RetCtrlDevFlowRat
  DATATYPE
    Float
  LONGFORM
    ReturnControlDeviceFlowRatio   
  INPUTCLASS
    NotInput
  DEFAULT
    switch( RetCtrlFlag )
    case 1 : RetCtrlDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( RetCtrlDevFlowRat, 0 )
ENDRULE

// ---------- Fully Ducted Return - Laboratory or Vivarium --------------------
// Not Used for T24N
RULE AirSys:FullyDuctedRetLabOrVivFlag
  DESCRIPTION
    "A flag to indicate that the proposed system serves a laboratory or
     vivarium, and is provided with fully ducted return."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( FullyDuctedRetLabOrVivFlag, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedRetLabOrVivPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnLabOrVivariumPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for fully ducted return for systems, 
     serving Laboratory or Vivarium spaces'."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedRetLabOrVivFlag )
    case 1 : 2.15
    default: 0
    endswitch
  SIZING
    ValidOr( FullyDuctedRetLabOrVivPDAdj, 0 )
ENDRULE
RULE AirSys:FullyDuctedRetLabOrVivDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( FullyDuctedRetFlag )
    case 1 : ValidOr( RetFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedRetLabOrVivDevFlow > RetFanCap + Proj:PDDevFlowTol ) )
    then 
      PostError("For HVAC System '%s': The input device flow for the 
                Fully ducted return systems, lab or vivarium' fan pressure 
                credit (%.0f cfm) exceeds the system return fan flow (%.0f cfm).  
                Revise inputs for consistency.",
                Name, FullyDuctedRetDevFlow, RetFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( FullyDuctedRetLabOrVivDevFlow, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedRetLabOrVivFlowRat
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnLabOrVivariumFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedRetLabOrVivFlag )
    case 1 : FullyDuctedRetLabOrVivDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( FullyDuctedRetLabOrVivFlowRat, 0 )
ENDRULE
RULE NEW AirSys:FullyDuctedRetLabOrVivPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnLabOrVivariumPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for fully ducted return for systems, 
     serving Laboratory or Vivarium spaces'."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Particulate Filtration Credit: MERV 9 through 12 --------------
// Not Used for T24N
RULE AirSys:MERV9To12Flag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with MERV 9 
     to MERV 12 filters"  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( MERV9To12Flag, 0 )
ENDRULE
RULE NEW AirSys:MERV9To12PDAdj
  DATATYPE
    Float
  LONGFORM
    MERV9To12PDPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for particulate filtration credit: 
     MERV 9 through 12."    
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV9To12Flag )
    case 1 : 0.5
    default: 0
    endswitch
  SIZING
    ValidOr( MERV9To12PDAdj, 0 )
ENDRULE
RULE AirSys:MERV9To12DevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( MERV9To12Flag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( MERV9To12Flag > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Particulate Filtration Credit, Merv 9 through 12' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, MERV9To12Flag, SupFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( MERV9To12DevFlow, 0 )
ENDRULE
RULE NEW AirSys:MERV9To12FlowRat
  DATATYPE
    Float
  LONGFORM
    MERV9To12PDPressureDropAdjustment
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV9To12Flag )
    case 1 : MERV9To12DevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( MERV9To12FlowRat, 0 )
ENDRULE
RULE NEW AirSys:MERV9To12PwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    MERV9To12PowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for particulate filtration credit: 
     MERV 9 through 12."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Particulate Filtration Credit: MERV 13 through 15 --------------
RULE AirSys:MERV13To15Flag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with MERV 13 
     to MERV 15 filters"  
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
  SIZING
    ValidOr( MERV13To15Flag, 0 )
ENDRULE
RULE NEW AirSys:MERV13To15PDAdj
  DATATYPE
    Float
  LONGFORM
    MERV13To15PressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for particulate filtration credit: 
     MERV 13 through 15."     
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV13To15Flag )
    case 1 : 0.5
    default: 0
    endswitch
  SIZING
    ValidOr( MERV13To15PDAdj, 0 )
ENDRULE
RULE AirSys:MERV13To15DevFlow
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( MERV13To15Flag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( MERV13To15DevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Particulate Filtration Credit, Merv 13 through 15' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, MERV13To15DevFlow, SupFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( MERV13To15DevFlow, 0 )
ENDRULE
RULE NEW AirSys:MERV13To15FlowRat
  DATATYPE
    Float
  LONGFORM
    MERV13To15FlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV13To15Flag )
    case 1 : MERV13To15DevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( MERV13To15FlowRat, 0 )
ENDRULE
RULE NEW AirSys:MERV13To15PwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    MERV13To15PowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for particulate filtration credit: 
     MERV 13 through 15."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
// ---------- Particulate Filtration Credit: MERV 16+ ----------------
RULE AirSys:MERVGTE16Flag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with MERV 16 or 
     greater filters, or electronically enhanced filters."    
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( MERVGTE16Flag, 0 )
ENDRULE
RULE AirSys:MERVGTE16DsgnPD
  DESCRIPTION
    "The design CLEAN pressure drop of the MERV 16 or greater filters, or 
     electronically enhanced filters, at fan system design conditions."  
  HELP
    "Value entered should be the pressure drop through the device at the 
     design flow when new, i.e. the 'clean' pressure drop." 
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( MERVGTE16DsgnPD, 0 )
ENDRULE
RULE NEW AirSys:MERVGTE16PDAdj
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16PressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for particulate filtration credit: 
     MERV 16 or greater or electronically enhanced filters."
  HELP
    "Pressure drop adjustment is 2x the 'clean' filter pressure drop 
     at design condition."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERVGTE16Flag )
    case 1 : 2 * MERVGTE16DsgnPD
    default: 0
    endswitch
  SIZING
    ValidOr( MERVGTE16PDAdj, 0 )
ENDRULE
RULE AirSys:MERVGTE16DevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( MERVGTE16Flag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( MERVGTE16DevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Particulate Filtration Credit, Merv 16 or greater' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, MERVGTE16DevFlow, SupFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( MERVGTE16DevFlow, 0 )
ENDRULE
RULE NEW AirSys:MERVGTE16PwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16PowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for particulate filtration credit: 
     MERV 16 or greater or electronically enhanced filters."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( MERVGTE16Flag > 0 ) .AND.
        IfValidAnd( MERVGTE16DevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:MERVGTE16( "SysType", FanSysType,
                                       "FlowCap", MERVGTE16DevFlow ) *
      ( MERVGTE16DsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( MERVGTE16PwrIdxAdj, 0 )
ENDRULE
RULE NEW AirSys:MERVGTE16FlowRat
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16FlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERVGTE16Flag )
    case 1 : MERVGTE16DevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( MERVGTE16FlowRat, 0 )
ENDRULE

// ---------- Carbon and other gas-phase air cleaners -----------------------
RULE AirSys:GasPhaseAirCleanersFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with carbon or 
     other gas-phase air cleaners"
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( GasPhaseAirCleanersFlag, 0 )
ENDRULE
RULE AirSys:GasPhaseAirCleanersDsgnPD
  DESCRIPTION
    "The clean filter design pressure drop of the carbon or other gas-phase air
     cleaners, at fan system design conditions."  
  HELP
    "Value entered should be the pressure drop through the device at the 
     design flow when new, i.e. the 'clean' pressure drop." 
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( GasPhaseAirCleanersDsgnPD, 0 )
ENDRULE
RULE NEW AirSys:GasPhaseAirCleanersPDAdj
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for carbon and other gas-phase 
     air cleaners."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( GasPhaseAirCleanersFlag )
    case 1 : GasPhaseAirCleanersDsgnPD
    default: 0
    endswitch
  SIZING
    ValidOr( GasPhaseAirCleanersPDAdj, 0 )
ENDRULE
RULE AirSys:GasPhaseAirCleanersDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( GasPhaseAirCleanersFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( GasPhaseAirCleanersDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Carbon and other gas phase air cleaners' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, GasPhaseAirCleanersDevFlow, SupFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( GasPhaseAirCleanersDevFlow, 0 )
ENDRULE
RULE NEW AirSys:GasPhaseAirCleanersPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for for carbon and other gas-phase 
     air cleaners."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( GasPhaseAirCleanersFlag > 0 ) .AND.
        IfValidAnd( GasPhaseAirCleanersDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:GasPhaseAirCleaners( "SysType", FanSysType,
                                            "FlowCap", GasPhaseAirCleanersDevFlow ) *
      ( GasPhaseAirCleanersDsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( GasPhaseAirCleanersPwrIdxAdj, 0 )
ENDRULE
RULE NEW AirSys:GasPhaseAirCleanersFlowRat
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( GasPhaseAirCleanersFlag )
    case 1 : GasPhaseAirCleanersDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( GasPhaseAirCleanersFlowRat, 0 )
ENDRULE

// ---------- Energy recovery device, other than Coil Runaround Loop ----------
RULE AirSys:ERVFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with an energy
     recovery device, other than a coil runaround loop."
  INPUTCLASS : T24N
    NotInput  
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( ERVFlag, 0 )
ENDRULE
RULE AirSys:ERVEff
  DESCRIPTION
    "The design pressure drop of the energy recovery device, at fan system design 
     conditions."  
  INPUTCLASS : T24N
    NotInput  
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( ERVEff, 0 )
ENDRULE
RULE NEW AirSys:ERVPDAdj
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatorPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for energy recovery devices,
     other than coil runaround loops."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ERVFlag )
    case 1 : Max(0,(2.2*ERVEff)-(2*0.5))
    default: 0
    endswitch
  SIZING
    ValidOr( ERVPDAdj, 0 )
ENDRULE
RULE AirSys:ERVDevFlow
  INPUTCLASS : T24N
    NotInput  
  INPUTCLASS
    Default
  DEFAULT
    switch( ERVFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ERVDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Energy recovery device, other than Coil Runaround Loop' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, ERVDevFlow, SupFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( ERVDevFlow, 0 )
ENDRULE
RULE NEW AirSys:ERVFlowRat
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatiorFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ERVFlag )
    case 1 : ERVDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( ERVFlowRat, 0 )
ENDRULE
RULE NEW AirSys:ERVPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatorPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for energy recovery devices,
     other than coil runaround loops."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Evaporative humidifier/cooler in series w/ another cooling coil -
// Not Used for T24N
RULE AirSys:EvapHumOrClrFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with an
     evaporative humidifier/cooler in series w/ another cooling coil."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( EvapHumOrClrFlag, 0 )
ENDRULE
RULE AirSys:EvapHumOrClrDsgnPD
  DESCRIPTION
    "The design pressure drop of the evaporative humidifier/cooler, at fan
     system design conditions."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( EvapHumOrClrDsgnPD, 0 )
ENDRULE
RULE NEW AirSys:EvapHumOrClrPDAdj
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for evaporative humidifier/cooler
     in series w/ another cooling coil."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( EvapHumOrClrFlag )
    case 1 : EvapHumOrClrDsgnPD
    default: 0
    endswitch
  SIZING
    ValidOr( EvapHumOrClrPDAdj, 0 )
ENDRULE
RULE AirSys:EvapHumOrClrDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( EvapHumOrClrFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( EvapHumOrClrDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Evaporative humidifier/cooler in series w/ another cooling
                coil' fan pressure credit (%.0f cfm) exceeds the system 
                supply fan flow (%.0f cfm).  Revise inputs for consistency.",
                Name, EvapHumOrClrDevFlow, SupFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( EvapHumOrClrDevFlow, 0 )
ENDRULE
RULE NEW AirSys:EvapHumOrClrFlowRat
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( EvapHumOrClrFlag )
    case 1 : EvapHumOrClrDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( EvapHumOrClrFlowRat, 0 )
ENDRULE
RULE NEW AirSys:EvapHumOrClrPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for evaporative humidifier/cooler
     in series w/ another cooling coil."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Sound Attenuation Section ---------------------------------------
// Not Used for T24N
RULE AirSys:SndAttnFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with a
     sound attenuation section."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
  SIZING
    ValidOr( SndAttnFlag, 0 )
ENDRULE
RULE NEW AirSys:SndAttnPDAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for a sound attenuation section."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( SndAttnFlag )
    case 1 : 0.15
    default: 0
    endswitch
  SIZING
    ValidOr( SndAttnPDAdj, 0 )
ENDRULE
RULE AirSys:SndAttnDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( SndAttnFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( SndAttnDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Sound Attenuation Section' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, SndAttnDevFlow, SupFanCap)
    else UNCHANGED
    endif
  SIZING
    ValidOr( SndAttnDevFlow, 0 )
ENDRULE
RULE NEW AirSys:SndAttnFlowRat
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( SndAttnFlag )
    case 1 : SndAttnDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
  SIZING
    ValidOr( SndAttnFlowRat, 0 )
ENDRULE
RULE NEW AirSys:SndAttnPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for the sound attenuation section."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// =========================== Zone System ====================================
// *************************** Exhaust Systems ********************************
// ---------- Fully Ducted Exhaust --------------------------------------------
RULE ZnSys:FullyDuctedExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with fully ducted 
     exhaust."  
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:FullyDuctedExhPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for fully ducted exhaust."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedExhFlag )
    case 1 : 0.5
    default: 0
    endswitch
ENDRULE
RULE ZnSys:FullyDuctedExhDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( FullyDuctedExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedExhDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then PostError("For Exhaust System '%s': The input device flow for the 
                    'Fully ducted exhaust air systems' fan pressure credit 
                    (%.0f cfm) exceeds the total system exhaust fan flow
                    (%.0f cfm).  Revise inputs for consistency.",
                     Name, FullyDuctedExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:FullyDuctedExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for fully ducted exhaust."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( FullyDuctedExhFlag > 0 ) .AND.
        IfValidAnd( FullyDuctedExhDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:FullyDuctedExh( "SysType", FanSysType,
                                            "FlowCap", FullyDuctedExhDevFlow )
    else 0
    endif
  SIZING
    ValidOr( FullyDuctedExhPwrIdxAdj, 0 )
ENDRULE

// ---------- Exhaust Airflow Control Device---------------------------------
RULE ZnSys:ExhCtrlFlag
  DESCRIPTION
    "A flag to indicate that the proposed system has an exhaust airflow 
     control device."  
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:ExhCtrlPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for the an exhaust airflow 
     control device."    
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ExhCtrlFlag )
    case 1 : 0.5
    default: 0
    endswitch
ENDRULE
RULE ZnSys:ExhCtrlDevFlow
  DESCRIPTION
    "The airflow through the exhaust airflow control device."        
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( ExhCtrlFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ExhCtrlDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                exhaust airflow control device fan pressure credit 
                (%.0f cfm) exceeds the total system exhaust fan flow
                (%.0f cfm).  Revise inputs for consistency.",
                Name, ExhCtrlDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:ExhCtrlPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustControlPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for exhaust control device."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Fully Ducted Exhaust - Laboratory or Vivarium -------------------
// Not Used for T24N
RULE ZnSys:FullyDuctedExhLabOrVivFlag
  DESCRIPTION
    "A flag to indicate that the proposed system serves a laboratory or
     vivarium, and is provided with fully ducted exhaust systems."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:FullyDuctedExhLabOrVivPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment fully ducted exhaust for systems 
     serving Laboratory or Vivarium spaces."    
  UNITS 
    inH2O 
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( FullyDuctedExhLabOrVivFlag )
    case 1 : 2.15
    default: 0
    endswitch
ENDRULE
RULE ZnSys:FullyDuctedExhLabOrVivDevFlow
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedExhLabOrVivFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedExhLabOrVivDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Fully ducted exhaust air systems, lab or viavarium' fan 
                pressure credit (%.0f cfm) exceeds the total system exhaust 
                fan flow (%.0f cfm).  Revise inputs for consistency.",
                Name, FullyDuctedExhLabOrVivDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:FullyDuctedExhLabOrVivPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment of fully ducted exhaust for systems 
     serving Laboratory or Vivarium spaces." 
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Exhaust filters, scrubbers, or other exhaust treatment ----------
RULE ZnSys:ExhFiltersFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with exhaust 
     filters, scrubbers, or other exhaust treatment."  
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE ZnSys:ExhFiltersDsgnPD
  DESCRIPTION
    "The design pressure drop of the exhaust treatment, at fan system design
     conditions."  
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:ExhFiltersPDAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment foir exhaust filters, scrubbers, 
     or other exhaust treatment."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ExhFiltersFlag )
    case 1 : ExhFiltersDsgnPD
    default: 0
    endswitch
ENDRULE
RULE ZnSys:ExhFiltersDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( ExhFiltersFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ExhFiltersDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Exhaust filters, scrubbers, or other exhaust treatment' 
                fan pressure credit (%.0f cfm) exceeds the
                total system exhaust fan flow (%.0f cfm).  Revise inputs for 
                consistency.",
                Name, ExhFiltersDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:ExhFiltersPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for exhaust filters, scrubbers, 
     or other exhaust treatment."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( ExhFiltersFlag > 0 ) .AND.
        IfValidAnd( ExhFiltersDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:ExhFilters( "SysType", FanSysType,
                                        "FlowCap", ExhFiltersDevFlow ) *
      ( ExhFiltersDsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( ExhFiltersPwrIdxAdj, 0 )
ENDRULE
// Value used to determine baseline fan power based on proposed inclusion of ExhFilters 
RULE NEW ZnSys:ExhFiltersPwrAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT : T24N_2019
    if( IsExhSys > 0 .AND. 
        IfValidAnd( LabArea > 0 ) .AND.
        IfValidAnd( ExhSysType = "Laboratory" ) .AND.
        ExhFiltersFlag > 0 )
    then 
      ExhFiltersPDAdj * ExhFiltersDevFlow * ( 0.1175 / 745.6 ) / 0.65
    else 0
    endif
  DEFAULT : T24N
    if( IsExhSys > 0 .AND. 
        IfValidAnd( LabArea > 0 ) .AND.
        IfValidAnd( ExhSysType = "Laboratory" ) .AND.
        ExhFiltersFlag > 0 )
    then 
      ExhFiltersDevFlow * ExhFiltersPwrIdxAdj / 1000
    else 0
    endif
  SIZING
    ValidOr( ExhFiltersPwrAdj, 0 )
ENDRULE

// ---------- Biosafety Cabinet -----------------------------------------------
RULE ZnSys:BiosftyCabExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed systems is an exhaust system serving
     a biosafety cabinet"
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE ZnSys:BiosftyCabExhDsgnPD
  DESCRIPTION
    "The design pressure drop of the biosafety cabinet, at fan system design 
     conditions."  
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:BiosftyCabExhPDAdj
  DATATYPE
    Float
  LONGFORM
    BiosafetyCabinetPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for biosafety cabinets."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( BiosftyCabExhFlag )
    case 1 : BiosftyCabExhDsgnPD
    default: 0
    endswitch
ENDRULE
RULE ZnSys:BiosftyCabExhDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( BiosftyCabExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ExhFiltersDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Biosafety Cabinet' fan pressure credit (%.0f cfm) exceeds 
                the total system exhaust fan flow (%.0f cfm).  Revise inputs
                for consistency.",
                Name, BiosftyCabExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE 
RULE NEW ZnSys:BiosftyCabExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    BiosafetyCabinetExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for biosafety cabinets."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( BiosftyCabExhFlag > 0 ) .AND.
        IfValidAnd( BiosftyCabExhDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:BiosftyCabExh( "SysType", FanSysType,
                                           "FlowCap", BiosftyCabExhDevFlow ) *
      ( BiosftyCabExhDsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( BiosftyCabExhPwrIdxAdj, 0 )
ENDRULE

// ---------- Exhaust system serving fume hood --------------------------------
RULE ZnSys:FumeHoodExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is an exhaust system serving
     a fume hood."
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:FumeHoodExhPDAdj
  DATATYPE
    Float
  LONGFORM
    FumeHoodExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for exhaust system serving fume hood." 
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FumeHoodExhFlag )
    case 1 : 0.35
    default: 0
    endswitch
ENDRULE
RULE ZnSys:FumeHoodExhDevFlow
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( FumeHoodExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FumeHoodExhDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Exhaust system serving fume hood' fan pressure credit 
                (%.0f cfm) exceeds the total system exhaust fan flow (%.0f cfm).  
                Revise inputs for consistency.",
                Name, FumeHoodExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:FumeHoodExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FumeHoodExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for exhaust system serving fume hood."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Laboratory and vivarium exhaust systems in high-rise buildings ---
// Not Used for T24N
RULE ZnSys:LabOrVivExhHiRiseFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is an exhaust system serving a
     laboratory or vivarium and located in a high-rise building."
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE ZnSys:LabOrVivExhHiRiseVertDuctLen
  DESCRIPTION
    "The vertical duct length of the Lab/Vivarium exhaust system."  
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:LabOrVivExhHiRisePDAdj
  DATATYPE
    Float
  LONGFORM
    LabOrVivariumExhaustHighRisePressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment as for laboratory and vivarium
     exhaust systems in high-rise buildings."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( LabOrVivExhHiRiseFlag )
    case 1 : 0.25*Max(0,(LabOrVivExhHiRiseVertDuctLen-75)/100)
    default: 0
    endswitch
ENDRULE
RULE ZnSys:LabOrVivExhHiRiseDevFlow
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( LabOrVivExhHiRiseFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( LabOrVivExhHiRiseDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Laboratory and vivarium exhaust systems in high-rise 
                buildings' fan pressure credit (%.0f cfm) exceeds the total 
                system exhaust fan flow (%.0f cfm).  Revise inputs for 
                consistency.",
                Name, LabOrVivExhHiRiseDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:LabOrVivExhHiRisePwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    LabOrVivariumExhaustHighRisePowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for laboratory and vivarium
     exhaust systems in high-rise buildings."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
  
// ---------- Sound Attenuation Section For Exhaust----------------------------
// Not Used for T24N
RULE ZnSys:SndAttnExhFlag
  DESCRIPTION
    "A flag to indicate that the proposed exhaust system is provided with a
     sound attenuation section."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:SndAttnExhPDAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for the sound attenuation section."    
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( SndAttnExhFlag )
    case 1 : 0.15
    default: 0
    endswitch
ENDRULE
RULE ZnSys:SndAttnExhDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( SndAttnExhFlag )
    case 1 : ValidOr( ExhFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( SndAttnExhDevFlow > ExhFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Exhaust System '%s': The input device flow for the 
                'Sound Attenuation Section' fan pressure credit (%.0f cfm) 
                exceeds the total system exhaust fan flow (%.0f cfm).  
                Revise inputs for consistency.",
                Name, SndAttnExhDevFlow, ExhFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:SndAttnExhPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationExhaustPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for the sound attenuation section."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE


// *************************** Supply Systems *********************************
// ---------- Fully Ducted Return ---------------------------------------------
RULE ZnSys:FullyDuctedRetFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with fully ducted 
     return."  
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:FullyDuctedRetPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for a fully ducted return."      
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedRetFlag )
    case 1 : 0.5
    default: 0
    endswitch
ENDRULE
RULE ZnSys:FullyDuctedRetDevFlow
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( FullyDuctedRetFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedRetDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Fully ducted return systems' fan pressure credit (%.0f cfm) 
                exceeds the system return fan flow (%.0f cfm).  Revise 
                inputs for consistency.",
                Name, FullyDuctedRetDevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:FullyDuctedRetPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for fully ducted return."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( FullyDuctedRetFlag > 0 ) .AND.
        IfValidAnd( FullyDuctedRetDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:FullyDuctedRet( "SysType", FanSysType,
                                            "FlowCap", FullyDuctedRetDevFlow )
    else 0
    endif
  SIZING
    ValidOr( FullyDuctedRetPwrIdxAdj, 0 )
ENDRULE
RULE NEW ZnSys:FullyDuctedRetFlowRat
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedRetFlag )
    case 1 : FullyDuctedRetDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

// ---------- Return Airflow Control Device---------------------------------
// Not Used for T24N
RULE ZnSys:RetCtrlFlag
  DESCRIPTION
    "A flag to indicate that the proposed system has a return airflow 
     control device."    
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:RetCtrlPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for the return airflow 
     control device."    
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( RetCtrlFlag )
    case 1 : 0.5
    default: 0
    endswitch
ENDRULE
RULE ZnSys:RetCtrlDevFlow
  DESCRIPTION
    "The airflow through the return airflow control device."        
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( RetCtrlFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( RetCtrlDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For Air System '%s': The input device flow for the 
                return airflow control device fan pressure credit 
                (%.0f cfm) exceeds the total system return fan flow
                (%.0f cfm).  Revise inputs for consistency.",
                Name, RetCtrlDevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:RetCtrlPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    ReturnControlPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for the return airflow 
     control device." 
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
RULE NEW ZnSys:RetCtrlDevFlowRat
  DATATYPE
    Float
  LONGFORM
    ReturnControlDeviceFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( RetCtrlFlag )
    case 1 : RetCtrlDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

;// ---------- Fully Ducted Return - Laboratory or Vivarium --------------------
// Not Used for T24N
RULE ZnSys:FullyDuctedRetLabOrVivFlag
  DESCRIPTION
    "A flag to indicate that the proposed system serves a laboratory or
     vivarium, and is provided with fully ducted return."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:FullyDuctedRetLabOrVivPDAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnLabOrVivariumPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for fully ducted return for systems, 
     serving Laboratory or Vivarium spaces'."  
  UNITS 
    inH2O 
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( FullyDuctedRetLabOrVivFlag )
    case 1 : 2.15
    default: 0
    endswitch
ENDRULE
RULE ZnSys:FullyDuctedRetLabOrVivDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( FullyDuctedRetLabOrVivFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( FullyDuctedRetLabOrVivDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Fully ducted return systems, lab or vivarium' fan pressure 
                credit (%.0f cfm) exceeds the system return fan flow (%.0f cfm).  
                Revise inputs for consistency.",
                Name, FullyDuctedRetLabOrVivDevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:FullyDuctedRetLabOrVivPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnLabOrVivariumPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for fully ducted return for systems, 
     serving Laboratory or Vivarium spaces'."  
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
RULE NEW ZnSys:FullyDuctedRetLabOrVivFlowRat
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnLabOrVivariumFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( FullyDuctedRetLabOrVivFlag )
    case 1 : FullyDuctedRetLabOrVivDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

// ---------- Particulate Filtration Credit: MERV 9 through 12 --------------
// Not Used for T24N
RULE ZnSys:MERV9To12Flag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with MERV 9 
     to MERV 12 filters"  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:MERV9To12PDAdj
  DATATYPE
    Float
  LONGFORM
    MERV9To12PDPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for particulate filtration credit: 
     MERV 9 through 12."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV9To12Flag )
    case 1 : 0.5
    default: 0
    endswitch
ENDRULE
RULE ZnSys:MERV9To12DevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( MERV9To12Flag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( MERV9To12Flag > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Particulate Filtration Credit, Merv 9 through 12' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, MERV9To12Flag, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:MERV9To12PwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    MERV9To12PowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for particulate filtration credit: 
     MERV 9 through 12."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
RULE NEW ZnSys:MERV9To12FlowRat
  DATATYPE
    Float
  LONGFORM
    MERV9To12PDPressureDropAdjustment
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV9To12Flag )
    case 1 : MERV9To12DevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

// ---------- Particulate Filtration Credit: MERV 13 through 15 --------------
RULE ZnSys:MERV13To15Flag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with MERV 13 
     to MERV 15 filters"  
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:MERV13To15PDAdj
  DATATYPE
    Float
  LONGFORM
    MERV13To15PressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for particulate filtration credit: 
     MERV 13 through 15."  
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV13To15Flag )
    case 1 : 0.5
    default: 0
    endswitch
ENDRULE
RULE ZnSys:MERV13To15DevFlow
  INPUTCLASS : T24N
    NotInput
  INPUTCLASS 
    Default
  DEFAULT
    switch( MERV13To15Flag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( MERV13To15DevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Particulate Filtration Credit, Merv 13 through 15' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, MERV13To15DevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:MERV13To15FlowRat
  DATATYPE
    Float
  LONGFORM
    MERV13To15FlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERV13To15Flag )
    case 1 : MERV13To15DevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE
RULE NEW ZnSys:MERV13To15PwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    MERV13To15PowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for particulate filtration credit: 
     MERV 13 through 15."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Particulate Filtration Credit: MERV 9 through 12 ----------------
RULE ZnSys:MERVGTE16Flag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with MERV 16 or 
     greater filters, or electronically enhanced filters."    
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE ZnSys:MERVGTE16DsgnPD
  DESCRIPTION
    "The design pressure drop of the MERV 16 or greater filters, or 
     electronically enhanced filters, at fan system design conditions."  
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:MERVGTE16PDAdj
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16PressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for particulate filtration credit: 
     MERV 16 or greater or electronically enhanced filters."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERVGTE16Flag )
    case 1 : 2 * MERVGTE16DsgnPD
    default: 0
    endswitch
ENDRULE
RULE ZnSys:MERVGTE16DevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( MERVGTE16Flag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( MERVGTE16DevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Particulate Filtration Credit, Merv 16 or greater' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, MERVGTE16DevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:MERVGTE16PwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16PowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for particulate filtration credit: 
     MERV 16 or greater or electronically enhanced filters."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( MERVGTE16Flag > 0 ) .AND.
        IfValidAnd( MERVGTE16DevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:MERVGTE16( "SysType", FanSysType,
                                       "FlowCap", MERVGTE16DevFlow ) *
      ( MERVGTE16DsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( MERVGTE16PwrIdxAdj, 0 )
ENDRULE
RULE NEW ZnSys:MERVGTE16FlowRat
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16FlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( MERVGTE16Flag )
    case 1 : MERVGTE16DevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

// ---------- Carbon and other gas-phase air cleaners -----------------------
RULE ZnSys:GasPhaseAirCleanersFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with carbon or 
     other gas-phase air cleaners"
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE ZnSys:GasPhaseAirCleanersDsgnPD
  DESCRIPTION
    "The clean filter design pressure drop of the carbon or other gas-phase air
     cleaners, at fan system design conditions."  
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:GasPhaseAirCleanersPDAdj
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for carbon and other gas-phase 
     air cleaners."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( GasPhaseAirCleanersFlag )
    case 1 : GasPhaseAirCleanersDsgnPD
    default: 0
    endswitch
ENDRULE
RULE ZnSys:GasPhaseAirCleanersDevFlow
  INPUTCLASS
    Default
  DEFAULT
    switch( GasPhaseAirCleanersFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( GasPhaseAirCleanersDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                 'Carbon and other gas phase air cleaners' fan 
                 pressure credit (%.0f cfm) exceeds the system supply fan 
                 flow (%.0f cfm).  Revise inputs for consistency.",
                 Name, GasPhaseAirCleanersDevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:GasPhaseAirCleanersPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for for carbon and other gas-phase 
     air cleaners."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2022 T24N_2025
    if( IfValidAnd( GasPhaseAirCleanersFlag > 0 ) .AND.
        IfValidAnd( GasPhaseAirCleanersDevFlow > 0 ) .AND.
        LocalStatus( FanSysType ) > 0 )
    then 
      T24N_2022FanPwrIdxAdj:GasPhaseAirCleaners( "SysType", FanSysType,
                                                 "FlowCap", GasPhaseAirCleanersDevFlow ) *
      ( GasPhaseAirCleanersDsgnPD / Proj:FanPwrIdxAdjNormPD )
    else 0
    endif
  SIZING
    ValidOr( GasPhaseAirCleanersPwrIdxAdj, 0 )
ENDRULE
RULE NEW ZnSys:GasPhaseAirCleanersFlowRat
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( GasPhaseAirCleanersFlag )
    case 1 : GasPhaseAirCleanersDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

// ---------- Energy recovery device, other than Coil Runaround Loop ----------
// Not Used for T24N
RULE ZnSys:ERVFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with an energy
     recovery device, other than a coil runaround loop."
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE ZnSys:ERVEff
  DESCRIPTION
    "The design pressure drop of the energy recovery device, at fan system design 
     conditions."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:ERVPDAdj
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatiorPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for energy recovery devices,
     other than coil runaround loops."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ERVFlag )
    case 1 : Max( 0, ( 2.2 * ERVEff ) - ( 2 * 0.5 ) )
    default: 0
    endswitch
ENDRULE
RULE ZnSys:ERVDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( ERVFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( ERVDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Energy recovery device, other than Coil Runaround Loop' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, ERVDevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:ERVPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatorPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for energy recovery devices,
     other than coil runaround loops."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
RULE NEW ZnSys:ERVFlowRat
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatorFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( ERVFlag )
    case 1 : ERVDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

// ---------- Evaporative humidifier/cooler in series w/ another cooling coil -
// Not Used for T24N
RULE ZnSys:EvapHumOrClrFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with an
     evaporative humidifier/cooler in series w/ another cooling coil."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE ZnSys:EvapHumOrClrDsgnPD
  DESCRIPTION
    "The design pressure drop of the evaporative humidifier/cooler, at fan
     system design conditions."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:EvapHumOrClrPDAdj
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for evaporative humidifier/cooler
     in series w/ another cooling coil."
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( EvapHumOrClrFlag )
    case 1 : EvapHumOrClrDsgnPD
    default: 0
    endswitch
ENDRULE
RULE ZnSys:EvapHumOrClrDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( EvapHumOrClrFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( EvapHumOrClrDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Evaporative humidifier/cooler in series w/ another cooling
                coil' fan pressure credit (%.0f cfm) exceeds the system 
                supply fan flow (%.0f cfm).  Revise inputs for consistency.",
                Name, EvapHumOrClrDevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:EvapHumOrClrFlowRat
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( EvapHumOrClrFlag )
    case 1 : EvapHumOrClrDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE
RULE NEW ZnSys:EvapHumOrClrPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for evaporative humidifier/cooler
     in series w/ another cooling coil."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE

// ---------- Sound Attenuation Section ---------------------------------------
// Not Used for T24N
RULE ZnSys:SndAttnFlag
  DESCRIPTION
    "A flag to indicate that the proposed system is provided with a
     sound attenuation section."  
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    0
ENDRULE
RULE NEW ZnSys:SndAttnPDAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationPressureDropAdjustment
  DESCRIPTION
    "The fan power pressure drop adjustment for a sound attenuation section." 
  UNITS 
    inH2O 
  INPUTCLASS
    NotInput
  DEFAULT
    switch( SndAttnFlag )
    case 1 : 0.15
    default: 0
    endswitch
ENDRULE
RULE ZnSys:SndAttnDevFlow
  INPUTCLASS : T24N
    NotInput     
  INPUTCLASS
    Default
  DEFAULT
    switch( SndAttnFlag )
    case 1 : ValidOr( SupFanCap, 0 )
    default: 0
    endswitch
  CHECKCODE
    if( IfValidAnd( SndAttnDevFlow > SupFanCap + Proj:PDDevFlowTol ) )
    then
      PostError("For HVAC System '%s': The input device flow for the 
                'Sound Attenuation Section' fan 
                pressure credit (%.0f cfm) exceeds the system supply fan 
                flow (%.0f cfm).  Revise inputs for consistency.",
                Name, SndAttnDevFlow, SupFanCap)
    else UNCHANGED
    endif
ENDRULE
RULE NEW ZnSys:SndAttnPwrIdxAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationPowerIndexAdjustment
  DESCRIPTION
    "The fan power index adjustment for the sound attenuation section."
  UNITS 
    W/cfm
  INPUTCLASS
    NotInput
// TO DO: Update PwrIdxAdj formulas for credits not used for T24N
  DEFAULT
    0
  SIZING
    0
ENDRULE
RULE NEW ZnSys:SndAttnFlowRat
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationFlowRatio
  INPUTCLASS
    NotInput
  DEFAULT
    switch( SndAttnFlag )
    case 1 : SndAttnDevFlow / ValidOr( SupFanCap, 1 )
    default: 0
    endswitch
ENDRULE

// Calculations
// =========================== Thermal Zone ===================================

// ---------- Zone Primary Airflow for Fan Power Credit Calcs -----------------
// Exhaust
RULE NEW ThrmlZn:FullyDuctedExhPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPwrAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    1  
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:FullyDuctedExhPwrAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        FullyDuctedExhPwrAdjAllowed > 0 )
    then ( ExhSysRef:FullyDuctedExhPDAdj *
           ExhSysRef:FullyDuctedExhDevFlow *
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        FullyDuctedExhPwrAdjAllowed > 0 )
    then ( ExhSysRef:FullyDuctedExhPwrIdxAdj *
           ExhSysRef:FullyDuctedExhDevFlow *
           ExhZnToSysFlowRat ) / 1000
    else 0
    endif
  SIZING_BASELINE
    zp:FullyDuctedExhPwrAdj
ENDRULE

RULE NEW ThrmlZn:ExhCtrlPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    ExhaustControlFanPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:ExhCtrlPwrAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustControlFanPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        ExhCtrlPwrAdjAllowed > 0 )
    then ( ExhSysRef:ExhCtrlPDAdj *
           ExhSysRef:ExhCtrlDevFlow *
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    0
  SIZING_BASELINE
    zp:ExhCtrlPwrAdj
ENDRULE

RULE NEW ThrmlZn:FullyDuctedExhLabOrVivPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumFanPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:FullyDuctedExhLabOrVivPwrAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        FullyDuctedExhLabOrVivPwrAdjAllowed > 0 )
    then ( ExhSysRef:FullyDuctedExhLabOrVivPDAdj *
           ExhSysRef:FullyDuctedExhLabOrVivDevFlow *    
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    0  
  SIZING_BASELINE
    zp:FullyDuctedExhLabOrVivPwrAdj
ENDRULE

RULE NEW ThrmlZn:ExhFiltersPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    if( IsRes > 0 )
    then 0
    else 1  
    endif
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:ExhFiltersPwrAdj
  DATATYPE
    Float
  LONGFORM
    ExhaustFiltersPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        ExhFiltersPwrAdjAllowed > 0 )
    then ( ExhSysRef:ExhFiltersPDAdj *
           ExhSysRef:ExhFiltersDevFlow *
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        ExhFiltersPwrAdjAllowed > 0 )
    then ( ExhSysRef:ExhFiltersPwrIdxAdj *
           ExhSysRef:ExhFiltersDevFlow *
           ExhZnToSysFlowRat ) / 1000
    else 0
    endif
  SIZING_BASELINE
    zp:ExhFiltersPwrAdj
ENDRULE

RULE NEW ThrmlZn:BiosftyCabExhPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    BiosafetyCabinetExhaustPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    if( IsRes > 0 )
    then 0
    else 1  
    endif
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:BiosftyCabExhPwrAdj
  DATATYPE
    Float
  LONGFORM
    BiosafetyCabinetExhaustPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        BiosftyCabExhPwrAdjAllowed > 0 )
    then ( ExhSysRef:BiosftyCabExhPDAdj *
           ExhSysRef:BiosftyCabExhDevFlow *
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        BiosftyCabExhPwrAdjAllowed > 0 )
    then ( ExhSysRef:BiosftyCabExhPwrIdxAdj *
           ExhSysRef:BiosftyCabExhDevFlow *
           ExhZnToSysFlowRat ) / 1000
    else 0
    endif
  SIZING_BASELINE
    zp:BiosftyCabExhPwrAdj
ENDRULE

RULE NEW ThrmlZn:FumeHoodExhPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    FumeHoodExhaustPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0 // Labs have separate fan power allowance
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:FumeHoodExhPwrAdj
  DATATYPE
    Float
  LONGFORM
    FumeHoodExhaustPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        FumeHoodExhPwrAdjAllowed > 0 )
    then ( ExhSysRef:FumeHoodExhPDAdj *
           ExhSysRef:FumeHoodExhDevFlow *
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    0  
  SIZING_BASELINE
    zp:FumeHoodExhPwrAdj
ENDRULE

RULE NEW ThrmlZn:LabOrVivExhHiRisePwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    LabOrVivariumExhaustHighRisePowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:LabOrVivExhHiRisePwrAdj
  DATATYPE
    Float
  LONGFORM
    LabOrVivariumExhaustHighRisePowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        LabOrVivExhHiRisePwrAdjAllowed > 0 )
    then ( ExhSysRef:LabOrVivExhHiRisePDAdj *
           ExhSysRef:LabOrVivExhHiRiseDevFlow *
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    0  
  SIZING_BASELINE
    zp:LabOrVivExhHiRisePwrAdj
ENDRULE

RULE NEW ThrmlZn:SndAttnExhPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationExhaustPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:SndAttnExhPwrAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationExhaustPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( LocalCompAssigned( ExhSysRef ) .AND. 
        SndAttnExhPwrAdjAllowed > 0 )
    then ( ExhSysRef:SndAttnExhPDAdj *
           ExhSysRef:SndAttnExhDevFlow *
           ExhZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  SIZING_PROPOSED : T24N
    0
  SIZING_BASELINE
    zp:SndAttnExhPwrAdj
ENDRULE

// Supply/Return
RULE NEW ThrmlZn:FullyDuctedRetPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    1
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:FullyDuctedRetPwrAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedReturnPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        FullyDuctedRetPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:FullyDuctedRetPDAdj *
            PriAirCondgSysRef[1]:FullyDuctedRetDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:FullyDuctedRetPDAdj *
            VentSysRef:FullyDuctedRetDevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:FullyDuctedRetPDAdj *
          PriAirCondgSysRef[1]:FullyDuctedRetDevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        FullyDuctedRetPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:FullyDuctedRetPwrIdxAdj *
            PriAirCondgSysRef[1]:FullyDuctedRetDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:FullyDuctedRetPwrIdxAdj *
            VentSysRef:FullyDuctedRetDevFlow *
            VentZnToSysFlowRat ) ) / 1000
      else
        ( PriAirCondgSysRef[1]:FullyDuctedRetPwrIdxAdj *
          PriAirCondgSysRef[1]:FullyDuctedRetDevFlow *
          PriZnToSysFlowRat ) / 1000
      endif endif
    else 0
    endif
  SIZING_BASELINE
    zp:FullyDuctedRetPwrAdj
  ANNUAL_BASELINE
    FullyDuctedRetPwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:RetCtrlPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    ReturnControlPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:RetCtrlPwrAdj
  DATATYPE
    Float
  LONGFORM
    ReturnControlPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        RetCtrlPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else      
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:RetCtrlPDAdj *
            PriAirCondgSysRef[1]:RetCtrlDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:RetCtrlPDAdj *
            VentSysRef:RetCtrlDevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:RetCtrlPDAdj *
          PriAirCondgSysRef[1]:RetCtrlDevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    0     
  SIZING_BASELINE
    zp:RetCtrlPwrAdj
  ANNUAL_BASELINE
    RetCtrlPwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:FullyDuctedRetLabOrVivPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:FullyDuctedRetLabOrVivPwrAdj
  DATATYPE
    Float
  LONGFORM
    FullyDuctedExhaustLabOrVivariumPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        FullyDuctedRetLabOrVivPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else    
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:FullyDuctedRetLabOrVivPDAdj *
            PriAirCondgSysRef[1]:FullyDuctedRetLabOrVivDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:FullyDuctedRetLabOrVivPDAdj *
            VentSysRef:FullyDuctedRetLabOrVivDevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:FullyDuctedRetLabOrVivPDAdj *
          PriAirCondgSysRef[1]:FullyDuctedRetLabOrVivDevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    0        
  SIZING_BASELINE
    zp:FullyDuctedRetLabOrVivPwrAdj
  ANNUAL_BASELINE
    FullyDuctedRetLabOrVivPwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:MERV9To12PwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    MERV9To12PDPressurePowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0   
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:MERV9To12PwrAdj
  DATATYPE
    Float
  LONGFORM
    MERV9To12PowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        MERV9To12PwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else    
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:MERV9To12PDAdj *
            PriAirCondgSysRef[1]:MERV9To12DevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:MERV9To12PDAdj *
            VentSysRef:MERV9To12DevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:MERV9To12PDAdj *
          PriAirCondgSysRef[1]:MERV9To12DevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    0 // Update in future  
  SIZING_BASELINE
    zp:MERV9To12PwrAdj
  ANNUAL_BASELINE
    MERV9To12PwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:MERV13To15PwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    MERV13To15PowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0   
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:MERV13To15PwrAdj
  DATATYPE
    Float
  LONGFORM
    MERV13To15PowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        MERV13To15PwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else    
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:MERV13To15PDAdj *
            PriAirCondgSysRef[1]:MERV13To15DevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:MERV13To15PDAdj *
            VentSysRef:MERV13To15DevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:MERV13To15PDAdj *
          PriAirCondgSysRef[1]:MERV13To15DevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    0 // Update in future  
  SIZING_BASELINE
    zp:MERV13To15PwrAdj  
  ANNUAL_BASELINE
    MERV13To15PwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:MERVGTE16PwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16PowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    1   
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:MERVGTE16PwrAdj
  DATATYPE
    Float
  LONGFORM
    MERVGreaterThanOrEqualTo16PowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        MERVGTE16PwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else       
      if( UniqueVentSysAssigned > 0 )
      then  
        ( ( PriAirCondgSysRef[1]:MERVGTE16PDAdj *
            PriAirCondgSysRef[1]:MERVGTE16DevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:MERVGTE16PDAdj *
            VentSysRef:MERVGTE16DevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:MERVGTE16PDAdj *
          PriAirCondgSysRef[1]:MERVGTE16DevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        MERVGTE16PwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else       
      if( UniqueVentSysAssigned > 0 )
      then  
        ( ( PriAirCondgSysRef[1]:MERVGTE16PwrIdxAdj *
            PriAirCondgSysRef[1]:MERVGTE16DevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:MERVGTE16PwrIdxAdj *
            VentSysRef:MERVGTE16DevFlow *
            VentZnToSysFlowRat ) ) / 1000
      else
        ( PriAirCondgSysRef[1]:MERVGTE16PwrIdxAdj *
          PriAirCondgSysRef[1]:MERVGTE16DevFlow *
          PriZnToSysFlowRat ) / 1000
      endif endif
    else 0
    endif   
  SIZING_BASELINE
    zp:MERVGTE16PwrAdj
  ANNUAL_BASELINE
    MERVGTE16PwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:GasPhaseAirCleanersPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    if( IsRes > 0 )
    then 0
    else 1  
    endif 
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:GasPhaseAirCleanersPwrAdj
  DATATYPE
    Float
  LONGFORM
    GasPhaseAirCleanersPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        GasPhaseAirCleanersPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else    
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:GasPhaseAirCleanersPDAdj *
            PriAirCondgSysRef[1]:GasPhaseAirCleanersDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:GasPhaseAirCleanersPDAdj *
            VentSysRef:GasPhaseAirCleanersDevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:GasPhaseAirCleanersPDAdj *
          PriAirCondgSysRef[1]:GasPhaseAirCleanersDevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        GasPhaseAirCleanersPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else    
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:GasPhaseAirCleanersPwrIdxAdj *
            PriAirCondgSysRef[1]:GasPhaseAirCleanersDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:GasPhaseAirCleanersPDAdj *
            VentSysRef:GasPhaseAirCleanersDevFlow *
            VentZnToSysFlowRat ) ) / 1000
      else
        ( PriAirCondgSysRef[1]:GasPhaseAirCleanersPwrIdxAdj *
          PriAirCondgSysRef[1]:GasPhaseAirCleanersDevFlow *
          PriZnToSysFlowRat ) / 1000
      endif endif
    else 0
    endif
  SIZING_BASELINE
    zp:GasPhaseAirCleanersPwrAdj
  ANNUAL_BASELINE
    GasPhaseAirCleanersPwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:ERVPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatorPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0 
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:ERVPwrAdj
  DATATYPE
    Float
  LONGFORM
    EnergyRecoveryVentilatorFanPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        ERVPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else      
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:ERVPDAdj *
            PriAirCondgSysRef[1]:ERVDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:ERVPDAdj *
            VentSysRef:ERVDevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:ERVPDAdj *
          PriAirCondgSysRef[1]:ERVDevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    0 // Update in future  
  SIZING_BASELINE
    zp:ERVPwrAdj
  ANNUAL_BASELINE
    ERVPwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:EvapHumOrClrPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0 
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:EvapHumOrClrPwrAdj
  DATATYPE
    Float
  LONGFORM
    EvaporativeHumidifierOrCoolerPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        EvapHumOrClrPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else      
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:EvapHumOrClrPDAdj *
            PriAirCondgSysRef[1]:EvapHumOrClrDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:EvapHumOrClrPDAdj *
            VentSysRef:EvapHumOrClrDevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:EvapHumOrClrPDAdj *
          PriAirCondgSysRef[1]:EvapHumOrClrDevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    0 // Update in future  
  SIZING_BASELINE
    zp:EvapHumOrClrPwrAdj
  ANNUAL_BASELINE
    EvapHumOrClrPwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

RULE NEW ThrmlZn:SndAttnPwrAdjAllowed
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationPowerAdjustmentAllowed
  INPUTCLASS
    NotInput
  DEFAULT : T24N
    0 
  DEFAULT
    1
ENDRULE
RULE NEW ThrmlZn:SndAttnPwrAdj
  DATATYPE
    Float
  LONGFORM
    SoundAttenuationPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  SIZING_PROPOSED : T24N_2019
    if( IsCond .AND. HasUnknownHVAC = 0 .AND.
        LocalCompAssigned( PriAirCondgSysRef[1] ) .AND.
        SndAttnPwrAdjAllowed > 0 )
    then
      if( PriAirCondgSysRef[1]:IsActiveBeam = 1 ) 
      then 0
      else      
      if( UniqueVentSysAssigned > 0 )
      then
        ( ( PriAirCondgSysRef[1]:SndAttnPDAdj *
            PriAirCondgSysRef[1]:SndAttnDevFlow *
            PriZnToSysFlowRat ) +
          ( VentSysRef:SndAttnPDAdj *
            VentSysRef:SndAttnDevFlow *
            VentZnToSysFlowRat ) ) * ( 0.1175 / 745.6 ) / 0.65 
      else
        ( PriAirCondgSysRef[1]:SndAttnPDAdj *
          PriAirCondgSysRef[1]:SndAttnDevFlow *
          PriZnToSysFlowRat ) * ( 0.1175 / 745.6 ) / 0.65 
      endif endif
    else 0
    endif
  SIZING_PROPOSED : T24N
    0
  SIZING_BASELINE
    zp:SndAttnPwrAdj 
  ANNUAL_BASELINE
    SndAttnPwrAdj * BaseToPropDsgnSupFlowRat
ENDRULE

// Totals
RULE NEW ThrmlZn:TotExhFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalExhaustFanPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  ANNUAL
    FullyDuctedExhPwrAdj +
    ExhCtrlPwrAdj +    
    FullyDuctedExhLabOrVivPwrAdj +
    ExhFiltersPwrAdj +
    BiosftyCabExhPwrAdj +
    FumeHoodExhPwrAdj +
    LabOrVivExhHiRisePwrAdj +
    SndAttnExhPwrAdj
ENDRULE

RULE NEW ThrmlZn:TotNonExhFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalNonExhaustFanPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  ANNUAL
    FullyDuctedRetPwrAdj +
    RetCtrlPwrAdj +    
    FullyDuctedRetLabOrVivPwrAdj + 
    MERV9To12PwrAdj +
    MERV13To15PwrAdj +
    MERVGTE16PwrAdj +
    GasPhaseAirCleanersPwrAdj +
    ERVPwrAdj +
    EvapHumOrClrPwrAdj +
    SndAttnPwrAdj
ENDRULE

RULE NEW ThrmlZn:TotFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalFanPowerAdjustment
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  ANNUAL
     TotNonExhFanPwrAdj + TotExhFanPwrAdj
ENDRULE


// ********** Sum of System Fan Power Adjustment Credits***********************
// =========================== AirSystem ======================================

RULE NEW AirSys:TotExhSysFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalExhaustSystemFanPowerAdjustment
  DESCRIPTION
    "The total exhaust system pressure drop adjustment."
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT : T24N_2019
    if( IfValidand( IsPropSys > 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference 
      ( FullyDuctedExhPDAdj * FullyDuctedExhDevFlow +
        ExhCtrlPDAdj * ExhCtrlDevFlow +
        FullyDuctedExhLabOrVivPDAdj * FullyDuctedExhLabOrVivDevFlow +
        ExhFiltersPDAdj * ExhFiltersDevFlow +
        BiosftyCabExhPDAdj * BiosftyCabExhDevFlow +
        FumeHoodExhPDAdj * FumeHoodExhDevFlow +
        LabOrVivExhHiRisePDAdj * LabOrVivExhHiRiseDevFlow +
        SndAttnExhPDAdj * SndAttnExhDevFlow ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  DEFAULT : T24N
    if( IfValidand( IsPropSys > 0 ) )
    then
    // Sum up user PD inputs, for reference 
      ( FullyDuctedExhPwrIdxAdj * FullyDuctedExhDevFlow +
        ExhFiltersPwrIdxAdj * ExhFiltersDevFlow +
        BiosftyCabExhPwrIdxAdj * BiosftyCabExhDevFlow ) / 1000
    else 0
    endif
  ANNUAL_PROPOSED : T24N_2019
    if( IsPropSys > 0 )
    then
    // Sum up user PD inputs and convert to bhp, for reference 
      ( FullyDuctedExhPDAdj * FullyDuctedExhDevFlow +
        ExhCtrlPDAdj * ExhCtrlDevFlow +
        FullyDuctedExhLabOrVivPDAdj * FullyDuctedExhLabOrVivDevFlow +
        ExhFiltersPDAdj * ExhFiltersDevFlow +
        BiosftyCabExhPDAdj * BiosftyCabExhDevFlow +
        FumeHoodExhPDAdj * FumeHoodExhDevFlow +
        LabOrVivExhHiRisePDAdj * LabOrVivExhHiRiseDevFlow +
        SndAttnExhPDAdj * SndAttnExhDevFlow ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  ANNUAL_PROPOSED : T24N
    if( IsPropSys > 0 )
    then
    // Sum up user PD inputs, for reference 
      ( FullyDuctedExhPwrIdxAdj * FullyDuctedExhDevFlow +
        ExhFiltersPwrIdxAdj * ExhFiltersDevFlow +
        BiosftyCabExhPwrIdxAdj * BiosftyCabExhDevFlow ) / 1000
    else 0
    endif
  ANNUAL_BASELINE
  // Add up power adjustment from zones
    SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:TotExhFanPwrAdj )
ENDRULE

RULE NEW AirSys:TotNonExhSysFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalNonExhaustSystemFanPowerAdjustment
  DESCRIPTION
    "The total non-exhaust system pressure drop adjustment."
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT : T24N_2019
    if( IfValidAnd( IsPropSys > 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPDAdj * FullyDuctedRetDevFlow +
        RetCtrlPDAdj * RetCtrlDevFlow +
        FullyDuctedRetLabOrVivPDAdj * FullyDuctedRetLabOrVivDevFlow + 
        MERV9To12PDAdj * MERV9To12DevFlow +
        MERV13To15PDAdj * MERV13To15DevFlow +
        MERVGTE16PDAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPDAdj * GasPhaseAirCleanersDevFlow +
        ERVPDAdj * ERVDevFlow +
        EvapHumOrClrPDAdj * EvapHumOrClrDevFlow +
        SndAttnPDAdj * SndAttnDevFlow ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  DEFAULT : T24N
    if( IfValidAnd( IsPropSys > 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPwrIdxAdj * FullyDuctedRetDevFlow +
        MERVGTE16PwrIdxAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPwrIdxAdj * GasPhaseAirCleanersDevFlow ) / 1000
    else 0
    endif
  ANNUAL_PROPOSED : T24N_2019
    if( IsPropSys > 0 )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPDAdj * FullyDuctedRetDevFlow +
        RetCtrlPDAdj * RetCtrlDevFlow +
        FullyDuctedRetLabOrVivPDAdj * FullyDuctedRetLabOrVivDevFlow + 
        MERV9To12PDAdj * MERV9To12DevFlow +
        MERV13To15PDAdj * MERV13To15DevFlow +
        MERVGTE16PDAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPDAdj * GasPhaseAirCleanersDevFlow +
        ERVPDAdj * ERVDevFlow +
        EvapHumOrClrPDAdj * EvapHumOrClrDevFlow +
        SndAttnPDAdj * SndAttnDevFlow ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  ANNUAL_PROPOSED : T24N
    if( IfValidAnd( IsPropSys > 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPwrIdxAdj * FullyDuctedRetDevFlow +
        MERVGTE16PwrIdxAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPwrIdxAdj * GasPhaseAirCleanersDevFlow ) / 1000
    else 0
    endif
  ANNUAL_BASELINE
  // Add up power adjustment from zones  
    SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:TotNonExhFanPwrAdj )
ENDRULE

RULE NEW AirSys:TotSysFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalSystemFanPowerAdjustment
  DESCRIPTION
    "The total non-exhaust system pressure drop adjustment."
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT
    ValidOr( TotNonExhSysFanPwrAdj, 0 ) + ValidOr( TotExhSysFanPwrAdj, 0 )
  ANNUAL
    ValidOr( TotNonExhSysFanPwrAdj, 0 ) + ValidOr( TotExhSysFanPwrAdj, 0 )
ENDRULE

// =========================== ZoneSystem =====================================

RULE NEW ZnSys:TotExhSysFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalExhaustSystemFanPowerAdjustment
  DESCRIPTION
    "The total exhaust system pressure drop adjustment."
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT : T24N_2019
    if( IfValidAnd( IsPropSys > 0 ) .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedExhPDAdj * FullyDuctedExhDevFlow +
        ExhCtrlPDAdj * ExhCtrlDevFlow +    
        FullyDuctedExhLabOrVivPDAdj * FullyDuctedExhLabOrVivDevFlow +
        ExhFiltersPDAdj * ExhFiltersDevFlow +
        BiosftyCabExhPDAdj * BiosftyCabExhDevFlow +
        FumeHoodExhPDAdj * FumeHoodExhDevFlow +
        LabOrVivExhHiRisePDAdj * LabOrVivExhHiRiseDevFlow +
        SndAttnExhPDAdj * SndAttnExhDevFlow ) * ( 0.1175 / 745.6 ) / 0.65
    else 0
    endif
  DEFAULT : T24N
    if( IfValidAnd( IsPropSys > 0 ) .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference 
      ( FullyDuctedExhPwrIdxAdj * FullyDuctedExhDevFlow +
        ExhFiltersPwrIdxAdj * ExhFiltersDevFlow +
        BiosftyCabExhPwrIdxAdj * BiosftyCabExhDevFlow ) / 1000
    else 0
    endif
  ANNUAL_PROPOSED : T24N_2019
    if( IsPropSys > 0 .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedExhPDAdj * FullyDuctedExhDevFlow +
        ExhCtrlPDAdj * ExhCtrlDevFlow +    
        FullyDuctedExhLabOrVivPDAdj * FullyDuctedExhLabOrVivDevFlow +
        ExhFiltersPDAdj * ExhFiltersDevFlow +
        BiosftyCabExhPDAdj * BiosftyCabExhDevFlow +
        FumeHoodExhPDAdj * FumeHoodExhDevFlow +
        LabOrVivExhHiRisePDAdj * LabOrVivExhHiRiseDevFlow +
        SndAttnExhPDAdj * SndAttnExhDevFlow ) * ( 0.1175 / 745.6 ) / 0.65
    else 0
    endif 
  ANNUAL_PROPOSED : T24N
    if( IsPropSys > 0 .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference 
      ( FullyDuctedExhPwrIdxAdj * FullyDuctedExhDevFlow +
        ExhFiltersPwrIdxAdj * ExhFiltersDevFlow +
        BiosftyCabExhPwrIdxAdj * BiosftyCabExhDevFlow ) / 1000
    else 0
    endif
  ANNUAL_BASELINE
  // Add up power adjustment from zones  
    SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:TotExhFanPwrAdj )
ENDRULE

RULE NEW ZnSys:TotNonExhSysFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalNonExhaustSystemFanPowerAdjustment
  DESCRIPTION
    "The total non-exhaust system pressure drop adjustment."
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT : T24N_2019
    if( IfValidAnd( IsPropSys > 0 ) .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPDAdj * FullyDuctedRetDevFlow +
        RetCtrlPDAdj * RetCtrlDevFlow +  
        FullyDuctedRetLabOrVivPDAdj * FullyDuctedRetLabOrVivDevFlow + 
        MERV9To12PDAdj * MERV9To12DevFlow +
        MERV13To15PDAdj * MERV13To15DevFlow +
        MERVGTE16PDAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPDAdj * GasPhaseAirCleanersDevFlow +
        ERVPDAdj * ERVDevFlow +
        EvapHumOrClrPDAdj * EvapHumOrClrDevFlow +
        SndAttnPDAdj * SndAttnDevFlow ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  DEFAULT : T24N
    if( IfValidAnd( IsPropSys > 0 ) .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPwrIdxAdj * FullyDuctedRetDevFlow +
        MERVGTE16PwrIdxAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPwrIdxAdj * GasPhaseAirCleanersDevFlow ) / 1000
    else 0
    endif
  ANNUAL_PROPOSED : T24N_2019
    if( IsPropSys > 0 .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPDAdj * FullyDuctedRetDevFlow +
        RetCtrlPDAdj * RetCtrlDevFlow +  
        FullyDuctedRetLabOrVivPDAdj * FullyDuctedRetLabOrVivDevFlow + 
        MERV9To12PDAdj * MERV9To12DevFlow +
        MERV13To15PDAdj * MERV13To15DevFlow +
        MERVGTE16PDAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPDAdj * GasPhaseAirCleanersDevFlow +
        ERVPDAdj * ERVDevFlow +
        EvapHumOrClrPDAdj * EvapHumOrClrDevFlow +
        SndAttnPDAdj * SndAttnDevFlow ) * ( 0.1175 / 745.6 ) / 0.65 
    else 0
    endif
  ANNUAL_PROPOSED : T24N
    if( IsPropSys > 0 .AND. IfValidAnd( IsActiveBeam = 0 ) )
    then
    // Sum up user PD inputs and convert to bhp, for reference
      ( FullyDuctedRetPwrIdxAdj * FullyDuctedRetDevFlow +
        MERVGTE16PwrIdxAdj * MERVGTE16DevFlow +
        GasPhaseAirCleanersPwrIdxAdj * GasPhaseAirCleanersDevFlow ) / 1000
    else 0
    endif
  ANNUAL_BASELINE
  // Add up power adjustment from zones
    SumRevRef( ThrmlZn:PriAirCondgSysRef[1], ThrmlZn:TotNonExhFanPwrAdj )
ENDRULE

RULE NEW ZnSys:TotSysFanPwrAdj
  DATATYPE
    Float
  LONGFORM
    TotalSystemFanPowerAdjustment
  DESCRIPTION
    "The total system pressure drop adjustment."
  INPUTCLASS
    NotInput
  UNITS : T24N_2019
    bhp
  UNITS : T24N
    kW
  DEFAULT
    ValidOr( TotNonExhSysFanPwrAdj, 0 ) + ValidOr( TotExhSysFanPwrAdj, 0 )
  ANNUAL
    ValidOr( TotNonExhSysFanPwrAdj, 0 ) + ValidOr( TotExhSysFanPwrAdj, 0 )
ENDRULE

RULE ZnSys:TotFanPwrIdxAllow
  DESCRIPTION
    "The sum total of supply fan + exhaust fan power allowance per cfm calculated using Table 140.4-A & B"
  DEFAULT
    if( Proj:AutoEffInput > 0 )
    then
      if( IfValidAnd( ExhFanCap > 0 ) .AND. IfValidAnd( ExhFanPwr > 0 ) )
      then ExhFanPwr * 1000 / ExhFanCap
      else if( IfValidAnd( SupFanCap > 0 ) .AND. IfValidAnd( SupFanPwr > 0 ) )
      then SupFanPwr * 1000 / SupFanCap
      else if( Type = "VentilationOnly" )
      then RtdPwr / RtdFlowCap
      else UNDEFINED
      endif endif endif
    else UNDEFINED
    endif
  CHECKCODE
    if( LocalStatus( TotFanPwrIdxAllow ) < 1 .AND. IsLrgHlthCareFanSys > 0 )
    then PostError( "Total fan power allowance for ZoneSystem '%s' must be specified since this system
                     serves a healthcare facility with total fan power equal or greater than 1 kW", Name )
    else UNCHANGED
    endif
  SIZING_PROPOSED
    // fan power allowance per cfm for DOAS based on Std. 140.4(p)1
    if( IsLrgHlthCareFanSys = 0 .AND. IsHlthCareDOAS > 0 )
    then 1
    else UNCHANGED
    endif
ENDRULE

RULE ZnSys:SupFanPwrIdxAllow
  DESCRIPTION
    "The total supply fan power allowance per cfm calculated using Table 140.4-A"
  SIZING_PROPOSED
    if( IfValidAnd( TotFanPwrIdxAllow > 0 ) )
    then
      if( IfValidAnd( SupFanCap > 0 ) )
      then TotFanPwrIdxAllow
      else if( Type = "VentilationOnly" .AND. IfValidAnd( ExhSysType = "SupplyOnly" ) )
      then TotFanPwrIdxAllow
      else if( Type = "VentilationOnly" .AND. ( IfValidAnd( ExhSysType = "Balanced" ) .OR. IfValidAnd( ExhSysType = "HeatRecovery" ) ) )
      then TotFanPwrIdxAllow / 2
      else 0
      endif endif endif
    else 0
    endif
ENDRULE

RULE ZnSys:ExhFanPwrIdxAllow
  DESCRIPTION
    "The total exhaust fan power allowance per cfm calculated using Table 140.4-B"
  SIZING_PROPOSED
    if( IfValidAnd( TotFanPwrIdxAllow > 0 ) )
    then
      if( IfValidAnd( ExhFanCap > 0 ) )
      then TotFanPwrIdxAllow
      else if( Type = "VentilationOnly" .AND. IfValidAnd( ExhSysType = "ExhaustOnly" ) )
      then TotFanPwrIdxAllow
      else if( Type = "VentilationOnly" .AND. ( IfValidAnd( ExhSysType = "Balanced" ) .OR. IfValidAnd( ExhSysType = "HeatRecovery" ) ) )
      then TotFanPwrIdxAllow / 2
      else 0
      endif endif endif
    else 0
    endif
ENDRULE

RULE AirSys:SupFanPwrIdxAllow
  DESCRIPTION
    "The total supply fan power allowance per cfm calculated using in Table 140.4-A"
  DEFAULT
    if( Proj:AutoEffInput > 0 .AND. IfValidAnd( SupFanCap > 0 ) .AND. IfValidAnd( SupFanPwr > 0 ) )
    then SupFanPwr * 1000 / SupFanCap
    else UNDEFINED
    endif
  CHECKCODE
    if( LocalStatus( SupFanPwrIdxAllow ) < 1 .AND. SupFanCap > 0 .AND. IsLrgHlthCareFanSys > 0 )
    then PostError( "Total supply fan power allowance for AirSystem '%s' must be specified since this system
                     serves a healthcare facility with total fan power equal or greater than 1 kW", Name )
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( BaseSysNum > 0 )
    then UNDEFINED
    else if( LocalCompAssigned( PropVentOnlyZnSysRef ) )
    then PropVentOnlyZnSysRef:SupFanPwrIdxAllow
    else if( IsLrgHlthCareFanSys = 0 .AND. IsHlthCareDOAS > 0 .AND. SupFanPwr > 0 )
    then // fan power allowance per cfm for DOAS based on Std. 140.4(p)1
         if( ExhFanPwr + RetFanPwr + ReliefFanPwr = 0 )
         then 1.0
         else 0.5
         endif
    else UNCHANGED
    endif endif endif
ENDRULE

RULE AirSys:ExhFanPwrIdxAllow
  DESCRIPTION
    "The total exhaust fan power allowance per cfm calculated using Table 140.4-B"
  DEFAULT
    if( Proj:AutoEffInput > 0 .AND. IfValidAnd( ExhFanCap > 0 ) .AND. IfValidAnd( ExhFanPwr > 0 ) )
    then ExhFanPwr * 1000 / ExhFanCap
    else UNDEFINED
    endif
  CHECKCODE
    if( LocalStatus( ExhFanPwrIdxAllow ) < 1 .AND. ExhFanCap > 0 .AND. IsLrgHlthCareFanSys > 0 )
    then PostError( "Total exhaust fan power allowance for AirSystem '%s' must be specified since this system
                     serves a healthcare facility with total fan power equal or greater than 1 kW", Name )
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( BaseSysNum > 0 )
    then UNDEFINED
    else if( LocalCompAssigned( PropVentOnlyZnSysRef ) )
    then 0
    else if( IsLrgHlthCareFanSys = 0 .AND. IsHlthCareDOAS > 0 .AND. ExhFanPwr > 0 )
    then // fan power allowance per cfm for DOAS based on Std. 140.4(p)1
         if( SupFanPwr = 0 )
         then 1.0
         else 0 // Change to return so fan is simulated in AirLoopHVAC
         endif
    else UNCHANGED
    endif endif endif
ENDRULE

RULE AirSys:RetFanPwrIdxAllow
  DESCRIPTION
    "The total return fan power allowance per cfm calculated using Table 140.4-B"
  DEFAULT
    if( Proj:AutoEffInput > 0 .AND. IfValidAnd( RetFanCap > 0 ) .AND. IfValidAnd( RetFanPwr > 0 ) )
    then RetFanPwr * 1000 / RetFanCap
    else UNDEFINED
    endif
  CHECKCODE
    if( LocalStatus( RetFanPwrIdxAllow ) < 1 .AND. RetFanCap > 0 .AND. IsLrgHlthCareFanSys > 0 )
    then PostError( "Total return fan power allowance for AirSystem '%s' must be specified since this system
                     serves a healthcare facility with total fan power equal or greater than 1 kW", Name )
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( BaseSysNum > 0 )
    then UNDEFINED
    else if( LocalCompAssigned( PropVentOnlyZnSysRef ) )
    then PropVentOnlyZnSysRef:ExhFanPwrIdxAllow
    else if( IsLrgHlthCareFanSys = 0 .AND. IsHlthCareDOAS > 0 .AND. SupFanPwr > 0 .AND. RetFanPwr + ExhFanPwr > 0 )
    then // fan power allowance per cfm for DOAS based on Std. 140.4(p)1 (exhaust change to return so fan is simulated in AirLoopHVAC)
         0.5
    else UNCHANGED
    endif endif endif
ENDRULE

RULE AirSys:ReliefFanPwrIdxAllow
  DESCRIPTION
    "The total relief fan power allowance per cfm calculated using Table 140.4-B"
  DEFAULT
    if( Proj:AutoEffInput > 0 .AND. IfValidAnd( ReliefFanCap > 0 ) .AND. IfValidAnd( ReliefFanPwr > 0 ) )
    then ReliefFanPwr * 1000 / ReliefFanCap
    else UNDEFINED
    endif
  CHECKCODE
    if( LocalStatus( ReliefFanPwrIdxAllow ) < 1 .AND. ReliefFanCap > 0 .AND. IsLrgHlthCareFanSys > 0 )
    then PostError( "Total relief fan power allowance for AirSystem '%s' must be specified since this system
                     serves a healthcare facility with total fan power equal or greater than 1 kW", Name )
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( BaseSysNum > 0 )
    then UNDEFINED
    else if( LocalCompAssigned( PropVentOnlyZnSysRef ) )
    then 0
    else if( IsLrgHlthCareFanSys = 0 .AND. IsHlthCareDOAS > 0 .AND. ReliefFanPwr > 0 )
    then // fan power allowance per cfm for DOAS based on Std. 140.4(p)1
         0.5
    else UNCHANGED
    endif endif endif
ENDRULE
